



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="一位Blog" href="http://adamshang2333.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="一位Blog" href="http://adamshang2333.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="一位Blog" href="http://adamshang2333.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="docker" />


<link rel="canonical" href="http://adamshang2333.github.io/hou-duan/docker/docker-ru-men/">



  <title>
Docker 入门 2333 |
bit Blog = 一位 Blog = bit =>byte KB MB GB TB ... 积跬步而行千里</title>
<meta name="generator" content="Hexo 5.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Docker 入门 2333
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2022-02-07 22:21:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2022-02-07T22:21:00+08:00">2022-02-07</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>53k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>48 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">bit Blog</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://gitee.com/oldFun/picGitee/raw/master/img/wallhaven-lmejvq.jpg"></li>
          <li class="item" data-background-image="https://gitee.com/oldFun/picGitee/raw/master/img/wallhaven-vg7vk8.jpg"></li>
          <li class="item" data-background-image="https://gitee.com/oldFun/picGitee/raw/master/img/wallhaven-3z9p26.png"></li>
          <li class="item" data-background-image="https://gitee.com/oldFun/picGitee/raw/master/img/wallhaven-v9gke5.jpg"></li>
          <li class="item" data-background-image="https://gitee.com/oldFun/picGitee/raw/master/img/wallhaven-57wx33.jpg"></li>
          <li class="item" data-background-image="https://gitee.com/oldFun/picGitee/raw/master/img/wallhaven-m9d9x8.png"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="http://adamshang2333.github.io/hou-duan/docker/docker-ru-men/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/%E5%90%90%E8%88%8C.jpeg">
    <meta itemprop="name" content="别人都叫我老范">
    <meta itemprop="description" content="bit =>byte KB MB GB TB ... 积跬步而行千里, <div style='font-size: 0.8em;'> I.is (null); <br/>If (U.appear ()) <br/>I.turn (new World ('Fill With Love')) <br/>// 我的世界 <br/>// 直至遇见你 <br/>// 才熠熠生辉 </div> ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="一位 Blog">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <p>[toc]</p>
<h1 id="docker入门"><a class="anchor" href="#docker入门">#</a> Docker 入门</h1>
<h2 id="docker概述"><a class="anchor" href="#docker概述">#</a> Docker 概述</h2>
<ul>
<li>灵活小巧，可以简化部署成本</li>
<li>通过隔离机制 可以将 服务器利用到极致</li>
<li>可以避免部署的端口冲突</li>
<li>可以做到秒级启动</li>
<li>可以更便捷的升级和扩容</li>
</ul>
<h3 id="docker与虚拟机的区别"><a class="anchor" href="#docker与虚拟机的区别">#</a> Docker 与虚拟机的区别</h3>
<p>虚拟机和 Docker 都属于虚拟化技术<br />
虚拟机需要单独在宿主机中占用固定的资源，故而对资源的利用率较低。<br />
虚拟机就相当于一台独立的电脑<br />
对于隔离的操作，虚拟机需要开启多个才能实现，而 Docker 由于<strong>镜像</strong>机制，只需要将最核心的指令和环境打包 运行镜像即可。十分的小巧</p>
<p>！！！注意 Dockeshi 不是模拟的一个完整操作系统<br />
 Docker 是内核级别的虚拟化，可以在一个物理机上运行很多的容器实例</p>
<h2 id="docker的基本概念"><a class="anchor" href="#docker的基本概念">#</a> Docker 的基本概念</h2>
<h3 id="docker的基本组成"><a class="anchor" href="#docker的基本组成">#</a> Docker 的基本组成</h3>
<p><strong>image 镜像：</strong><br />
就好比时一个模板 可以通过镜像模板来创建容器服务，<br />
通过这个景象可以创建多个容器（类似 java 的 class 类模板创建对象实例）</p>
<p><strong>container 容器：</strong><br />
Docker 利用容器技术，独立运行一个或者一组应用， 通过镜像来创建<br />
可以粗略的理解成一个简易的 linux 系统</p>
<p><strong>repository  仓库</strong><br />
仓库就是存放镜像的地方<br />
分为私有仓库和公有仓库<br />
 Docker Hub 默认是使用 Docker 的国外仓库 访问会很慢<br />
故一般都会配置成国内的镜像加速（类似 Maven）</p>
<h2 id="docker-安装与卸载"><a class="anchor" href="#docker-安装与卸载">#</a> Docker 安装与卸载</h2>
<h3 id="docker-安装"><a class="anchor" href="#docker-安装">#</a> Docker 安装</h3>
<blockquote>
<p>步骤概要<br />
 1  卸载旧版本<br />
 sudo apt-get remove docker docker-engine <span class="exturl" data-url="aHR0cDovL2RvY2tlci5pbw==">docker.io</span> containerd runc<br />
2 使用 yum 或 apt-get 安装新版本<br />
 3 设置镜像的仓库<br />
 4 安装 docker 相关引擎等<br />
 sudo apt-get update<br />
sudo apt-get install docker-ce docker-ce-cli <span class="exturl" data-url="aHR0cDovL2NvbnRhaW5lcmQuaW8=">containerd.io</span><br />
5 查看 Docker 版本</p>
</blockquote>
<p>注: docker-ce  是社区版；docker-ee 是企业版<br />
企业版需要授权才可以</p>
<p>安装的时候 按照官方文档或百度即可<br />
官方文档地址：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGwvdWJ1bnR1Lw==">Docker 安装</span></p>
<h3 id="docker-卸载"><a class="anchor" href="#docker-卸载">#</a> Docker 卸载</h3>
<p>卸载 Docker 只分为两步:</p>
<blockquote>
<p>1 卸载 Docker 相关软件 (卸载软件不会将文件一并删除)<br />
sudo apt-get purge docker-ce docker-ce-cli <span class="exturl" data-url="aHR0cDovL2NvbnRhaW5lcmQuaW8=">containerd.io</span><br />
2 删除工作目录下文件<br />
 sudo rm -rf /var/lib/docker<br />
sudo rm -rf /var/lib/containerd<br />
<strong>Docker 默认工作路径</strong><br />
 <code>/var/lib/docker</code> <br />
 <code>/var/lib/containerd</code></p>
</blockquote>
<h2 id="docker-的启动流程和原理"><a class="anchor" href="#docker-的启动流程和原理">#</a> Docker 的启动流程和原理</h2>
<p>docker run 指令:<br />
<img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/20220209123519.png" alt="Docker run 的执行流程图" /></p>
<h3 id="底层原理"><a class="anchor" href="#底层原理">#</a> 底层原理</h3>
<p><strong>Docker 是怎么工作的？</strong><br />
Docker 是一个 Client-Server 结构的系统，Docker 的守护进程运行在宿主机上。通过 <strong>Socket</strong> 从客户端访问！<br />
DockerServer 接收到 Docker-Client 的指令 就会执行这个命令 (例如执行容器或镜像相关指令等)<br />
<img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/1644382102114.png" alt="" /></p>
<p><strong>Docker 为什么比虚拟机快</strong></p>
<ol>
<li>Docker 有着比虚拟机更少的抽象层</li>
<li>Docker 利用的是宿主机的内核，VM 需要单独加载 Guest OS 的操作系统内核 .</li>
</ol>
<blockquote>
<p>这个差异体现在创建容器的时候尤为明显:<br />
<strong>docker 不需要 VM 那样重新加载一个操作系统内核</strong>，避免引导 (直接使用宿主机操作系统), 可以做到秒级启动<br />
而 VM 需要单独加载 Guest OS, 启动往往都是分钟级</p>
</blockquote>
<h2 id="docker-的常用命令"><a class="anchor" href="#docker-的常用命令">#</a> Docker 的常用命令</h2>
<h3 id="帮助命令"><a class="anchor" href="#帮助命令">#</a> 帮助命令</h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker version           <span class="token comment"># 显示 docker 的版本信息</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker info              <span class="token comment"># 显示 docker 的系统信息，包括镜像和容器</span></pre></td></tr><tr><td data-num="3"></td><td><pre>docker <span class="token punctuation">[</span>命令<span class="token punctuation">]</span> --help     <span class="token comment"># 万能命令</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vcmVmZXJlbmNlLw==">官方指令帮助文档</span></p>
<h3 id="镜像命令"><a class="anchor" href="#镜像命令">#</a> 镜像命令</h3>
<h4 id="docker-images"><a class="anchor" href="#docker-images">#</a> **docker images **</h4>
<p>查看所有本地主机上的镜像</p>
<pre><code>root@VM-16-11-ubuntu:/etc/docker# docker images
REPOSITORY             TAG       IMAGE ID       CREATED        SIZE
hello-world            latest    feb5d9fea6a5   4 months ago   13.3kB
codercom/code-server   latest    08823d73807e   4 months ago   1.11GB
# 解释 
REPOSITORY      镜像的仓库源 (镜像的名字)
TAG         镜像的标签
IMAGE ID     镜像的 ID
SIZE            镜像的大小
# 可选项
Options:
  -a, --all             Show all images (default hides intermediate images)
      --digests         Show digests
  -f, --filter filter   Filter output based on conditions provided
      --format string   Pretty-print images using a Go template
      --no-trunc        Don't truncate output
  -q, --quiet           Only show image IDs
</code></pre>
<h4 id="docker-search"><a class="anchor" href="#docker-search">#</a> <strong>docker search</strong></h4>
<p>搜索镜像</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker search mysql</span></pre></td></tr><tr><td data-num="2"></td><td><pre>NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</pre></td></tr><tr><td data-num="3"></td><td><pre>mysql                             MySQL is a widely used, open-source relation…   <span class="token number">12086</span>     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       </pre></td></tr><tr><td data-num="4"></td><td><pre>mariadb                           MariaDB Server is a high performing <span class="token function">open</span> sou…   <span class="token number">4631</span>      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       </pre></td></tr><tr><td data-num="5"></td><td><pre>mysql/mysql-server                Optimized MySQL Server Docker images. Create…   <span class="token number">904</span>                  <span class="token punctuation">[</span>OK<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 可选项</span></pre></td></tr><tr><td data-num="8"></td><td><pre>Options:</pre></td></tr><tr><td data-num="9"></td><td><pre>  -f, --filter filter   Filter output based on conditions provided</pre></td></tr><tr><td data-num="10"></td><td><pre>      --format string   Pretty-print search using a Go template</pre></td></tr><tr><td data-num="11"></td><td><pre>      --limit int       Max number of search results <span class="token punctuation">(</span>default <span class="token number">25</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      --no-trunc        Don't truncate output</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>--filter<span class="token operator">=</span>START<span class="token operator">=</span><span class="token number">3000</span></pre></td></tr></table></figure><h4 id="docker-pull"><a class="anchor" href="#docker-pull">#</a> <strong>docker pull</strong></h4>
<p>下载镜像</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker pull <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> NAME<span class="token punctuation">[</span>:TAG<span class="token operator">|</span>DIGEST<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker pull mysql</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Using default tag: latest <span class="token comment">#不指定版本 tag 的话，默认下载最新版本</span></pre></td></tr><tr><td data-num="5"></td><td><pre>latest: Pulling from library/mysql</pre></td></tr><tr><td data-num="6"></td><td><pre>72a69066d2fe: Pull complete  <span class="token comment">#分层下载，docker image 的核心，联合文件系统</span></pre></td></tr><tr><td data-num="7"></td><td><pre>93619dbc5b36: Pull complete </pre></td></tr><tr><td data-num="8"></td><td><pre>99da31dd6142: Pull complete </pre></td></tr><tr><td data-num="9"></td><td><pre>626033c43d70: Pull complete </pre></td></tr><tr><td data-num="10"></td><td><pre>37d5d7efb64e: Pull complete </pre></td></tr><tr><td data-num="11"></td><td><pre>ac563158d721: Pull complete </pre></td></tr><tr><td data-num="12"></td><td><pre>d2ba16033dad: Pull complete </pre></td></tr><tr><td data-num="13"></td><td><pre>688ba7d5c01a: Pull complete </pre></td></tr><tr><td data-num="14"></td><td><pre>00e060b6d11d: Pull complete </pre></td></tr><tr><td data-num="15"></td><td><pre>1c04857f594f: Pull complete </pre></td></tr><tr><td data-num="16"></td><td><pre>4d7cfa90e6ea: Pull complete </pre></td></tr><tr><td data-num="17"></td><td><pre>e0431212d27d: Pull complete </pre></td></tr><tr><td data-num="18"></td><td><pre>Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709 <span class="token comment"># 签名</span></pre></td></tr><tr><td data-num="19"></td><td><pre>Status: Downloaded newer image <span class="token keyword">for</span> mysql:latest</pre></td></tr><tr><td data-num="20"></td><td><pre>docker.io/library/mysql:latest <span class="token comment"># 真实下载地址</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">#  下述指令等价</span></pre></td></tr><tr><td data-num="23"></td><td><pre>docker pull mysql  <span class="token operator">==</span> docker pull docker.io/library/mysql:latest</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker pull docker.io/library/mysql:latest</span></pre></td></tr><tr><td data-num="26"></td><td><pre>latest: Pulling from library/mysql</pre></td></tr><tr><td data-num="27"></td><td><pre>Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709</pre></td></tr><tr><td data-num="28"></td><td><pre>Status: Image is up to <span class="token function">date</span> <span class="token keyword">for</span> mysql:latest</pre></td></tr><tr><td data-num="29"></td><td><pre>docker.io/library/mysql:latest</pre></td></tr><tr><td data-num="30"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># </span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># 下载指定版本</span></pre></td></tr><tr><td data-num="33"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker pull mysql:5.7</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token number">5.7</span>: Pulling from library/mysql</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token comment"># 注意，由于利用了 Linux 的联合文件系统 实现分层下载，避免了重复的下载过程。只会对部分文件下载</span></pre></td></tr><tr><td data-num="36"></td><td><pre>72a69066d2fe: Already exists  </pre></td></tr><tr><td data-num="37"></td><td><pre>93619dbc5b36: Already exists </pre></td></tr><tr><td data-num="38"></td><td><pre>99da31dd6142: Already exists </pre></td></tr><tr><td data-num="39"></td><td><pre>626033c43d70: Already exists </pre></td></tr><tr><td data-num="40"></td><td><pre>37d5d7efb64e: Already exists </pre></td></tr><tr><td data-num="41"></td><td><pre>ac563158d721: Already exists </pre></td></tr><tr><td data-num="42"></td><td><pre>d2ba16033dad: Already exists </pre></td></tr><tr><td data-num="43"></td><td><pre>0ceb82207cd7: Pull complete </pre></td></tr><tr><td data-num="44"></td><td><pre>37f2405cae96: Pull complete </pre></td></tr><tr><td data-num="45"></td><td><pre>e2482e017e53: Pull complete </pre></td></tr><tr><td data-num="46"></td><td><pre>70deed891d42: Pull complete </pre></td></tr><tr><td data-num="47"></td><td><pre>Digest: sha256:f2ad209efe9c67104167fc609cca6973c8422939491c9345270175a300419f94</pre></td></tr><tr><td data-num="48"></td><td><pre>Status: Downloaded newer image <span class="token keyword">for</span> mysql:5.7</pre></td></tr><tr><td data-num="49"></td><td><pre>docker.io/library/mysql:5.7</pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment">#可选项</span></pre></td></tr><tr><td data-num="53"></td><td><pre>Options:</pre></td></tr><tr><td data-num="54"></td><td><pre>  -a, --all-tags                Download all tagged images <span class="token keyword">in</span> the repository</pre></td></tr><tr><td data-num="55"></td><td><pre>      --disable-content-trust   Skip image verification <span class="token punctuation">(</span>default <span class="token boolean">true</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>      --platform string         Set platform <span class="token keyword">if</span> server is multi-platform capable</pre></td></tr><tr><td data-num="57"></td><td><pre>  -q, --quiet                   Suppress verbose output</pre></td></tr></table></figure><h4 id="docker-rmi"><a class="anchor" href="#docker-rmi">#</a> <strong>docker rmi</strong></h4>
<p>删除镜像</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker rmi -f IMAGE ID <span class="token comment"># 删除指定的容器</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker rmi -f 容器ID 容器ID 容器ID <span class="token comment"># 删除多个容器，以空格分隔</span></pre></td></tr><tr><td data-num="3"></td><td><pre>docker rmi -f <span class="token variable"><span class="token variable">$(</span>docker images mysql -aq<span class="token variable">)</span></span> <span class="token comment"># 删除 $() 函数中匹配的镜像</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 因为 docker 的联合文件系统，如果有多版本的镜像，删除指定版本镜像 只会删除该版本独有的部分。与其他版本公用的不会删除</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>Options:</pre></td></tr><tr><td data-num="8"></td><td><pre>  -f, --force      Force removal of the image</pre></td></tr><tr><td data-num="9"></td><td><pre>      --no-prune   Do not delete untagged parents</pre></td></tr></table></figure><h4 id="docker-tag"><a class="anchor" href="#docker-tag">#</a> <strong>docker tag</strong></h4>
<p>更改镜像的标签</p>
<h4 id="docker-save"><a class="anchor" href="#docker-save">#</a> <strong>docker save</strong></h4>
<p>将<strong>镜像</strong>保存成<strong> tar 压缩包</strong>到本地，可以将压缩包发送给别人</p>
<blockquote>
<p><strong>docker export</strong> 命令用于将容器里的文件系统作为一个 tar 归档文件导出到标准输出，注意这两者的区别。</p>
</blockquote>
<h4 id="docker-load"><a class="anchor" href="#docker-load">#</a> <strong>docker load</strong></h4>
<p>用于从 tar 归档文件或者标准输入流载入镜像。docker load 命令的相对应的命令为 <strong>docker save</strong>。</p>
<h4 id="docker-export"><a class="anchor" href="#docker-export">#</a> docker export</h4>
<p>将<strong>容器</strong>打包成<strong> tar 压缩包</strong>导出到本地</p>
<h4 id="docker-import"><a class="anchor" href="#docker-import">#</a> <strong>docker import</strong></h4>
<p>从归档文件中创建镜像。docker import 命令的相对应的命令为 <strong>docker export</strong></p>
<h3 id="容器命令"><a class="anchor" href="#容器命令">#</a> 容器命令</h3>
<p><strong>注意：有了镜像才可以创建容器！</strong></p>
<h4 id="docker-run"><a class="anchor" href="#docker-run">#</a> docker run</h4>
<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run <span class="token punctuation">[</span>可选参数<span class="token punctuation">]</span> image</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 参数说明</span></pre></td></tr><tr><td data-num="4"></td><td><pre>--name<span class="token operator">=</span><span class="token string">"Name"</span>  容器名字 mysql01<span class="token punctuation">..</span>.用来区分容器</pre></td></tr><tr><td data-num="5"></td><td><pre>-d    后台方式运行</pre></td></tr><tr><td data-num="6"></td><td><pre>-i ,--interactive                    Keep STDIN <span class="token function">open</span> even <span class="token keyword">if</span> not attached</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>-t ,--tty                            Allocate a pseudo-TTY</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>-it     使用交互方式运行,进入容器查看内容</pre></td></tr><tr><td data-num="11"></td><td><pre>-P    指定容器的端口</pre></td></tr><tr><td data-num="12"></td><td><pre>-p    随机指定端口</pre></td></tr><tr><td data-num="13"></td><td><pre>    -p ip:主机端口:容器端口</pre></td></tr><tr><td data-num="14"></td><td><pre>    -p 主机端口:容器端口<span class="token punctuation">(</span>常用<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    -p 容器端口</pre></td></tr><tr><td data-num="16"></td><td><pre>    容器端口</pre></td></tr><tr><td data-num="17"></td><td><pre>-e     配置 docker 启动时的环境变量</pre></td></tr><tr><td data-num="18"></td><td><pre>    </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 测试，启动并进入容器</span></pre></td></tr><tr><td data-num="20"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker run -it centos </span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 注意 进入容器后，主机名称 e8bb8f9d1818 就是镜像的 ID</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@e8bb8f9d1818 /<span class="token punctuation">]</span><span class="token comment"># </span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># 启动 ES 容器 并设置端口号，环境变量的内存限制 (ES 对内存的消耗很大)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker run -d --name es01 -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="-Xms128m -Xmx512m" elasticsearch:7.17.0</span></pre></td></tr></table></figure><h4 id="exit"><a class="anchor" href="#exit">#</a> exit</h4>
<p><strong>退出容器</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 从容器退回主机</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@e8bb8f9d1818 /<span class="token punctuation">]</span><span class="token comment"># exit # 直接退出 容器停止运行</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Ctrl + P + Q <span class="token comment"># 容器不停止退出</span></pre></td></tr></table></figure><h4 id="docker-ps"><a class="anchor" href="#docker-ps">#</a> docker ps</h4>
<p><strong>列出运行的容器</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker <span class="token function">ps</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token comment"># 列出当前正在运行的容器</span></pre></td></tr><tr><td data-num="3"></td><td><pre>-a    <span class="token comment"># 列出所有 (包括曾经运行的)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>-n<span class="token operator">=</span>?    <span class="token comment">#显示最近创建的 n 个容器</span></pre></td></tr><tr><td data-num="5"></td><td><pre>-q     <span class="token comment"># 只显示容器的编号</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker ps </span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker ps -a </span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker ps -n 1</span></pre></td></tr><tr><td data-num="12"></td><td><pre>CONTAINER ID   IMAGE         COMMAND       CREATED          STATUS                     PORTS     NAMES</pre></td></tr><tr><td data-num="13"></td><td><pre>e8bb8f9d1818   centos        <span class="token string">"/bin/bash"</span>   <span class="token number">54</span> minutes ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">6</span> minutes ago             happy_germain</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>Options:</pre></td></tr><tr><td data-num="17"></td><td><pre>  -a, --all             Show all containers <span class="token punctuation">(</span>default shows just running<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  -f, --filter filter   Filter output based on conditions provided</pre></td></tr><tr><td data-num="19"></td><td><pre>      --format string   Pretty-print containers using a Go template</pre></td></tr><tr><td data-num="20"></td><td><pre>  -n, --last int        Show n last created containers <span class="token punctuation">(</span>includes all states<span class="token punctuation">)</span> <span class="token punctuation">(</span>default -1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  -l, --latest          Show the latest created container <span class="token punctuation">(</span>includes all states<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      --no-trunc        Don't truncate output</pre></td></tr><tr><td data-num="23"></td><td><pre>  -q, --quiet           Only display container IDs</pre></td></tr><tr><td data-num="24"></td><td><pre>  -s, --size            Display total <span class="token function">file</span> sizes</pre></td></tr></table></figure><h4 id="docker-rm"><a class="anchor" href="#docker-rm">#</a> docker rm</h4>
<p><strong>删除容器</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker <span class="token function">rm</span> 容器 ID    <span class="token comment">#删除指定容器不能删除正在运行的容器</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span>docker <span class="token function">ps</span> -aq<span class="token variable">)</span></span>    <span class="token comment">#强制删除所有容器 (包括运行中)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>docker <span class="token function">ps</span> -a -q<span class="token operator">|</span><span class="token function">xargs</span> docker <span class="token function">rm</span> <span class="token comment"># 删除所有容器</span></pre></td></tr></table></figure><h4 id="docker-start"><a class="anchor" href="#docker-start">#</a> docker start</h4>
<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker start 容器 <span class="token function">id</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker restart 容器 <span class="token function">id</span></pre></td></tr><tr><td data-num="3"></td><td><pre>docker stop 容器 <span class="token function">id</span>  <span class="token comment"># 停止当前容器</span></pre></td></tr><tr><td data-num="4"></td><td><pre>docker <span class="token function">kill</span> 容器 <span class="token function">id</span>     <span class="token comment"># 强制停止当前容器</span></pre></td></tr></table></figure><h3 id="常用其他命令"><a class="anchor" href="#常用其他命令">#</a> 常用其他命令</h3>
<p><strong>后台启动容器</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker run -d centos</pre></td></tr><tr><td data-num="3"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker run -d centos</span></pre></td></tr><tr><td data-num="4"></td><td><pre>8c9f1b8bc6d48d643e774e7fbc4c159e89fde19df3c1af96b9d67707ba44ccbd</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 问题: docker 容器启动后，centos 停止了？？</span></pre></td></tr><tr><td data-num="6"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="7"></td><td><pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 常见的坑：容器使用后台运行，就必须要有一个前台进程，docker 发现没有应用 (对外服务或者前台挂起的应用), 就会自动停止</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># nginx , 容器启动后 发现自己没有提供服务 就会立刻停止，</span></pre></td></tr></table></figure><h4 id="docker-log"><a class="anchor" href="#docker-log">#</a> docker log</h4>
<p><strong>查看日志</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker logs 容器 <span class="token function">id</span></pre></td></tr></table></figure><h4 id="docker-top"><a class="anchor" href="#docker-top">#</a> docker top</h4>
<p><strong>查看容器中的进程信息</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker <span class="token function">top</span> 容器 <span class="token function">id</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker top e8bb8f9d1818</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token environment constant">UID</span>                 PID                 <span class="token environment constant">PPID</span>                C                   STIME               TTY                 TIME                CMD</pre></td></tr><tr><td data-num="4"></td><td><pre>root                <span class="token number">903340</span>              <span class="token number">903320</span>              <span class="token number">0</span>                   <span class="token number">15</span>:04               pts/0               00:00:00            /bin/bash</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># UID 当前用户 id</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># PID    进程 ID (progress ID)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># PPID 父进程 ID</span></pre></td></tr></table></figure><p><strong>查看镜像元数据</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker inspect 容器 <span class="token function">id</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker inspect e8bb8f9d1818</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment"># 容器 ID 只是展示全 ID 的缩写部分</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"e8bb8f9d18182d6793cb862b28894f4f4cc9a70af55404d85650210f96116570"</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-09T10:37:59.297096963Z"</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"Path"</span><span class="token builtin class-name">:</span> <span class="token string">"/bin/bash"</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token comment"># 向当前镜像传递的参数</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token string">"Args"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 容器的状态信息</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token string">"State"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token string">"Status"</span><span class="token builtin class-name">:</span> <span class="token string">"running"</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token string">"Running"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token string">"Paused"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token string">"Restarting"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token string">"OOMKilled"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token string">"Dead"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token string">"Pid"</span><span class="token builtin class-name">:</span> <span class="token number">903340</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token string">"ExitCode"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token string">"Error"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token string">"StartedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-10T07:04:26.650038011Z"</span>,</pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token string">"FinishedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-10T06:32:40.248012604Z"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># 容器所使用的镜像信息</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token string">"Image"</span><span class="token builtin class-name">:</span> <span class="token string">"sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6"</span>,</pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token string">"ResolvConfPath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/e8bb8f9d18182d6793cb862b28894f4f4cc9a70af55404d85650210f96116570/resolv.conf"</span>,</pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token string">"HostnamePath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/e8bb8f9d18182d6793cb862b28894f4f4cc9a70af55404d85650210f96116570/hostname"</span>,</pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token string">"HostsPath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/e8bb8f9d18182d6793cb862b28894f4f4cc9a70af55404d85650210f96116570/hosts"</span>,</pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token string">"LogPath"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/containers/e8bb8f9d18182d6793cb862b28894f4f4cc9a70af55404d85650210f96116570/e8bb8f9d18182d6793cb862b28894f4f4cc9a70af55404d85650210f96116570-json.log"</span>,</pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"/happy_germain"</span>,</pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token string">"RestartCount"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"overlay2"</span>,</pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token string">"Platform"</span><span class="token builtin class-name">:</span> <span class="token string">"linux"</span>,</pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token string">"MountLabel"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token string">"ProcessLabel"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token string">"AppArmorProfile"</span><span class="token builtin class-name">:</span> <span class="token string">"docker-default"</span>,</pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token string">"ExecIDs"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment"># 主机配置</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token string">"HostConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>            <span class="token string">"Binds"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token string">"ContainerIDFile"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token string">"LogConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"json-file"</span>,</pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token string">"NetworkMode"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,</pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token string">"PortBindings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token string">"RestartPolicy"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"no"</span>,</pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token string">"MaximumRetryCount"</span><span class="token builtin class-name">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="54"></td><td><pre>            <span class="token string">"AutoRemove"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="55"></td><td><pre>            <span class="token string">"VolumeDriver"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token string">"VolumesFrom"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="57"></td><td><pre>            <span class="token string">"CapAdd"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="58"></td><td><pre>            <span class="token string">"CapDrop"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="59"></td><td><pre>            <span class="token string">"CgroupnsMode"</span><span class="token builtin class-name">:</span> <span class="token string">"host"</span>,</pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token string">"Dns"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="61"></td><td><pre>            <span class="token string">"DnsOptions"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="62"></td><td><pre>            <span class="token string">"DnsSearch"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="63"></td><td><pre>            <span class="token string">"ExtraHosts"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token string">"GroupAdd"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="65"></td><td><pre>            <span class="token string">"IpcMode"</span><span class="token builtin class-name">:</span> <span class="token string">"private"</span>,</pre></td></tr><tr><td data-num="66"></td><td><pre>            <span class="token string">"Cgroup"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token string">"Links"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token string">"OomScoreAdj"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token string">"PidMode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="70"></td><td><pre>            <span class="token string">"Privileged"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="71"></td><td><pre>            <span class="token string">"PublishAllPorts"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="72"></td><td><pre>            <span class="token string">"ReadonlyRootfs"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="73"></td><td><pre>            <span class="token string">"SecurityOpt"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="74"></td><td><pre>            <span class="token string">"UTSMode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="75"></td><td><pre>            <span class="token string">"UsernsMode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token string">"ShmSize"</span><span class="token builtin class-name">:</span> <span class="token number">67108864</span>,</pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token string">"Runtime"</span><span class="token builtin class-name">:</span> <span class="token string">"runc"</span>,</pre></td></tr><tr><td data-num="78"></td><td><pre>            <span class="token string">"ConsoleSize"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                <span class="token number">0</span>,</pre></td></tr><tr><td data-num="80"></td><td><pre>                <span class="token number">0</span></pre></td></tr><tr><td data-num="81"></td><td><pre>            <span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="82"></td><td><pre>            <span class="token string">"Isolation"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token string">"CpuShares"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="84"></td><td><pre>            <span class="token string">"Memory"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="85"></td><td><pre>            <span class="token string">"NanoCpus"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="86"></td><td><pre>            <span class="token string">"CgroupParent"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="87"></td><td><pre>            <span class="token string">"BlkioWeight"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="88"></td><td><pre>            <span class="token string">"BlkioWeightDevice"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="89"></td><td><pre>            <span class="token string">"BlkioDeviceReadBps"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="90"></td><td><pre>            <span class="token string">"BlkioDeviceWriteBps"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="91"></td><td><pre>            <span class="token string">"BlkioDeviceReadIOps"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="92"></td><td><pre>            <span class="token string">"BlkioDeviceWriteIOps"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="93"></td><td><pre>            <span class="token string">"CpuPeriod"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token string">"CpuQuota"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="95"></td><td><pre>            <span class="token string">"CpuRealtimePeriod"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="96"></td><td><pre>            <span class="token string">"CpuRealtimeRuntime"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="97"></td><td><pre>            <span class="token string">"CpusetCpus"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="98"></td><td><pre>            <span class="token string">"CpusetMems"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="99"></td><td><pre>            <span class="token string">"Devices"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="100"></td><td><pre>            <span class="token string">"DeviceCgroupRules"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="101"></td><td><pre>            <span class="token string">"DeviceRequests"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="102"></td><td><pre>            <span class="token string">"KernelMemory"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="103"></td><td><pre>            <span class="token string">"KernelMemoryTCP"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="104"></td><td><pre>            <span class="token string">"MemoryReservation"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="105"></td><td><pre>            <span class="token string">"MemorySwap"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="106"></td><td><pre>            <span class="token string">"MemorySwappiness"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="107"></td><td><pre>            <span class="token string">"OomKillDisable"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="108"></td><td><pre>            <span class="token string">"PidsLimit"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="109"></td><td><pre>            <span class="token string">"Ulimits"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="110"></td><td><pre>            <span class="token string">"CpuCount"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="111"></td><td><pre>            <span class="token string">"CpuPercent"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="112"></td><td><pre>            <span class="token string">"IOMaximumIOps"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="113"></td><td><pre>            <span class="token string">"IOMaximumBandwidth"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="114"></td><td><pre>            <span class="token string">"MaskedPaths"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="115"></td><td><pre>                <span class="token string">"/proc/asound"</span>,</pre></td></tr><tr><td data-num="116"></td><td><pre>                <span class="token string">"/proc/acpi"</span>,</pre></td></tr><tr><td data-num="117"></td><td><pre>                <span class="token string">"/proc/kcore"</span>,</pre></td></tr><tr><td data-num="118"></td><td><pre>                <span class="token string">"/proc/keys"</span>,</pre></td></tr><tr><td data-num="119"></td><td><pre>                <span class="token string">"/proc/latency_stats"</span>,</pre></td></tr><tr><td data-num="120"></td><td><pre>                <span class="token string">"/proc/timer_list"</span>,</pre></td></tr><tr><td data-num="121"></td><td><pre>                <span class="token string">"/proc/timer_stats"</span>,</pre></td></tr><tr><td data-num="122"></td><td><pre>                <span class="token string">"/proc/sched_debug"</span>,</pre></td></tr><tr><td data-num="123"></td><td><pre>                <span class="token string">"/proc/scsi"</span>,</pre></td></tr><tr><td data-num="124"></td><td><pre>                <span class="token string">"/sys/firmware"</span></pre></td></tr><tr><td data-num="125"></td><td><pre>            <span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="126"></td><td><pre>            <span class="token string">"ReadonlyPaths"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="127"></td><td><pre>                <span class="token string">"/proc/bus"</span>,</pre></td></tr><tr><td data-num="128"></td><td><pre>                <span class="token string">"/proc/fs"</span>,</pre></td></tr><tr><td data-num="129"></td><td><pre>                <span class="token string">"/proc/irq"</span>,</pre></td></tr><tr><td data-num="130"></td><td><pre>                <span class="token string">"/proc/sys"</span>,</pre></td></tr><tr><td data-num="131"></td><td><pre>                <span class="token string">"/proc/sysrq-trigger"</span></pre></td></tr><tr><td data-num="132"></td><td><pre>            <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="133"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="134"></td><td><pre>        <span class="token string">"GraphDriver"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>            <span class="token string">"Data"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>                <span class="token string">"LowerDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/28f3d29731a06545d5226119d0d589da79cbd9d1108adc40c51c0c4cd6730caf-init/diff:/var/lib/docker/overlay2/8fb7b2906fad7645d1fd8863f1bdbb770160af761e63df58baf22fb4d493f3b2/diff"</span>,</pre></td></tr><tr><td data-num="137"></td><td><pre>                <span class="token string">"MergedDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/28f3d29731a06545d5226119d0d589da79cbd9d1108adc40c51c0c4cd6730caf/merged"</span>,</pre></td></tr><tr><td data-num="138"></td><td><pre>                <span class="token string">"UpperDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/28f3d29731a06545d5226119d0d589da79cbd9d1108adc40c51c0c4cd6730caf/diff"</span>,</pre></td></tr><tr><td data-num="139"></td><td><pre>                <span class="token string">"WorkDir"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/overlay2/28f3d29731a06545d5226119d0d589da79cbd9d1108adc40c51c0c4cd6730caf/work"</span></pre></td></tr><tr><td data-num="140"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="141"></td><td><pre>            <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"overlay2"</span></pre></td></tr><tr><td data-num="142"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="143"></td><td><pre><span class="token comment"># 挂载信息</span></pre></td></tr><tr><td data-num="144"></td><td><pre>        <span class="token string">"Mounts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="145"></td><td><pre><span class="token comment"># 容器的配置信息</span></pre></td></tr><tr><td data-num="146"></td><td><pre>        <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="147"></td><td><pre>            <span class="token string">"Hostname"</span><span class="token builtin class-name">:</span> <span class="token string">"e8bb8f9d1818"</span>,</pre></td></tr><tr><td data-num="148"></td><td><pre>            <span class="token string">"Domainname"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="149"></td><td><pre>            <span class="token string">"User"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="150"></td><td><pre>            <span class="token string">"AttachStdin"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="151"></td><td><pre>            <span class="token string">"AttachStdout"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="152"></td><td><pre>            <span class="token string">"AttachStderr"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="153"></td><td><pre>            <span class="token string">"Tty"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="154"></td><td><pre>            <span class="token string">"OpenStdin"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="155"></td><td><pre>            <span class="token string">"StdinOnce"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="156"></td><td><pre><span class="token comment"># 容器内的环境变量</span></pre></td></tr><tr><td data-num="157"></td><td><pre>            <span class="token string">"Env"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="158"></td><td><pre>                <span class="token string">"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"</span></pre></td></tr><tr><td data-num="159"></td><td><pre>            <span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="160"></td><td><pre><span class="token comment"># 容器内的指令</span></pre></td></tr><tr><td data-num="161"></td><td><pre>            <span class="token string">"Cmd"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="162"></td><td><pre>                <span class="token string">"/bin/bash"</span></pre></td></tr><tr><td data-num="163"></td><td><pre>            <span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="164"></td><td><pre>            <span class="token string">"Image"</span><span class="token builtin class-name">:</span> <span class="token string">"centos"</span>,</pre></td></tr><tr><td data-num="165"></td><td><pre>            <span class="token string">"Volumes"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="166"></td><td><pre>            <span class="token string">"WorkingDir"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="167"></td><td><pre>            <span class="token string">"Entrypoint"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="168"></td><td><pre>            <span class="token string">"OnBuild"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="169"></td><td><pre>            <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="170"></td><td><pre>                <span class="token string">"org.label-schema.build-date"</span><span class="token builtin class-name">:</span> <span class="token string">"20210915"</span>,</pre></td></tr><tr><td data-num="171"></td><td><pre>                <span class="token string">"org.label-schema.license"</span><span class="token builtin class-name">:</span> <span class="token string">"GPLv2"</span>,</pre></td></tr><tr><td data-num="172"></td><td><pre>                <span class="token string">"org.label-schema.name"</span><span class="token builtin class-name">:</span> <span class="token string">"CentOS Base Image"</span>,</pre></td></tr><tr><td data-num="173"></td><td><pre>                <span class="token string">"org.label-schema.schema-version"</span><span class="token builtin class-name">:</span> <span class="token string">"1.0"</span>,</pre></td></tr><tr><td data-num="174"></td><td><pre>                <span class="token string">"org.label-schema.vendor"</span><span class="token builtin class-name">:</span> <span class="token string">"CentOS"</span></pre></td></tr><tr><td data-num="175"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="176"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="177"></td><td><pre><span class="token comment"># 网络设置</span></pre></td></tr><tr><td data-num="178"></td><td><pre>        <span class="token string">"NetworkSettings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="179"></td><td><pre>            <span class="token string">"Bridge"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="180"></td><td><pre>            <span class="token string">"SandboxID"</span><span class="token builtin class-name">:</span> <span class="token string">"512da81282a36d9abd16224b959840b678c3664d2e8511ba62590ecc7e729f17"</span>,</pre></td></tr><tr><td data-num="181"></td><td><pre>            <span class="token string">"HairpinMode"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="182"></td><td><pre>            <span class="token string">"LinkLocalIPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="183"></td><td><pre>            <span class="token string">"LinkLocalIPv6PrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="184"></td><td><pre>            <span class="token string">"Ports"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="185"></td><td><pre>            <span class="token string">"SandboxKey"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/run/docker/netns/512da81282a3"</span>,</pre></td></tr><tr><td data-num="186"></td><td><pre>            <span class="token string">"SecondaryIPAddresses"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="187"></td><td><pre>            <span class="token string">"SecondaryIPv6Addresses"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="188"></td><td><pre>            <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"559f56fe1efedd0721108f17e25f1328b2032fa4b793f1e5ae395900b30dde9f"</span>,</pre></td></tr><tr><td data-num="189"></td><td><pre>            <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.1"</span>,</pre></td></tr><tr><td data-num="190"></td><td><pre>            <span class="token string">"GlobalIPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="191"></td><td><pre>            <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="192"></td><td><pre>            <span class="token string">"IPAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.2"</span>,</pre></td></tr><tr><td data-num="193"></td><td><pre>            <span class="token string">"IPPrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,</pre></td></tr><tr><td data-num="194"></td><td><pre>            <span class="token string">"IPv6Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="195"></td><td><pre>            <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:02"</span>,</pre></td></tr><tr><td data-num="196"></td><td><pre>            <span class="token string">"Networks"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="197"></td><td><pre>                <span class="token string">"bridge"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="198"></td><td><pre>                    <span class="token string">"IPAMConfig"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="199"></td><td><pre>                    <span class="token string">"Links"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="200"></td><td><pre>                    <span class="token string">"Aliases"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="201"></td><td><pre>                    <span class="token string">"NetworkID"</span><span class="token builtin class-name">:</span> <span class="token string">"572e26381ff1d7b4ea753f634000acf460d6fa5b3974b22ccc3c03446cfb2d86"</span>,</pre></td></tr><tr><td data-num="202"></td><td><pre>                    <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"559f56fe1efedd0721108f17e25f1328b2032fa4b793f1e5ae395900b30dde9f"</span>,</pre></td></tr><tr><td data-num="203"></td><td><pre>                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.1"</span>,</pre></td></tr><tr><td data-num="204"></td><td><pre>                    <span class="token string">"IPAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.2"</span>,</pre></td></tr><tr><td data-num="205"></td><td><pre>                    <span class="token string">"IPPrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,</pre></td></tr><tr><td data-num="206"></td><td><pre>                    <span class="token string">"IPv6Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="207"></td><td><pre>                    <span class="token string">"GlobalIPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="208"></td><td><pre>                    <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,</pre></td></tr><tr><td data-num="209"></td><td><pre>                    <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:02"</span>,</pre></td></tr><tr><td data-num="210"></td><td><pre>                    <span class="token string">"DriverOpts"</span><span class="token builtin class-name">:</span> null</pre></td></tr><tr><td data-num="211"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="212"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="213"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="214"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="215"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 容器通常都是使用后台运行的，修改配置等情况下 需要进入容器</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 方式一</span></pre></td></tr><tr><td data-num="4"></td><td><pre>docker <span class="token builtin class-name">exec</span> -it 容器id <span class="token function">bash</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 方式二</span></pre></td></tr><tr><td data-num="7"></td><td><pre>docker attach 容器id</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># docker exec   进入容器后打开一个新的终端窗口，可以在里面操作. exit 退出后 不会关闭当前运行的容器</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># docker attach  进入容器当前正在执行的终端，不会启动新的进程；</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token builtin class-name">exit</span> 退出后, 会将当前运行容器关闭</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 测试</span></pre></td></tr><tr><td data-num="14"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec -it e8bb8f9d1818  bash</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@e8bb8f9d1818 /<span class="token punctuation">]</span><span class="token comment"># exit</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token builtin class-name">exit</span></pre></td></tr><tr><td data-num="17"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="18"></td><td><pre>CONTAINER ID   IMAGE     COMMAND       CREATED        STATUS          PORTS     NAMES</pre></td></tr><tr><td data-num="19"></td><td><pre>e8bb8f9d1818   centos    <span class="token string">"/bin/bash"</span>   <span class="token number">23</span> hours ago   Up <span class="token number">34</span> seconds             happy_germain</pre></td></tr><tr><td data-num="20"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker attach e8bb8f9d1818</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>root@e8bb8f9d1818 /<span class="token punctuation">]</span><span class="token comment"># exit</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token builtin class-name">exit</span></pre></td></tr><tr><td data-num="23"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker ps</span></pre></td></tr><tr><td data-num="24"></td><td><pre>CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</pre></td></tr></table></figure><p><strong>从容器拷贝到宿主机</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker <span class="token function">cp</span> 容器 id:容器内路径 目的主机路径</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 注：将容器内的数据拷贝到宿主机上时，容器是否在运行不会影响数据拷贝 ==> 只要容器不删除 数据就不会消失！</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 进入容器</span></pre></td></tr><tr><td data-num="5"></td><td><pre>oot@VM-16-11-ubuntu:~<span class="token comment"># docker run -it centos</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@c18f3ab96a7b /<span class="token punctuation">]</span><span class="token comment"># cd home</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@c18f3ab96a7b home<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 在容器内部创建一个文件</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@c18f3ab96a7b home<span class="token punctuation">]</span><span class="token comment"># touch innerDocker.java</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@c18f3ab96a7b home<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="11"></td><td><pre>innerDocker.java</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>root@c18f3ab96a7b home<span class="token punctuation">]</span><span class="token comment"># exit</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token builtin class-name">exit</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 从容器拷贝到宿主机</span></pre></td></tr><tr><td data-num="15"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker cp c18f3ab96a7b:/home/innerDocker.java</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 拷贝是一个手动过程，之后可以使用 -v (卷) 的技术 实现自动同步</span></pre></td></tr></table></figure><h3 id="小结"><a class="anchor" href="#小结">#</a> 小结</h3>
<p><img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/1644488113312.png" alt="常用指令关系" /></p>
<p>指令小结</p>
<h2 id="可视化管理工具"><a class="anchor" href="#可视化管理工具">#</a> 可视化管理工具</h2>
<ul>
<li>portainer (不是最佳的选择)
<ul>
<li>Docker 的图形化管理工具，提供一个后台面板供我们操做</li>
</ul>
</li>
<li>Rancher (CI/CD)</li>
</ul>
<h2 id="docker-镜像讲解"><a class="anchor" href="#docker-镜像讲解">#</a> Docker 镜像讲解</h2>
<h3 id="镜像是什么"><a class="anchor" href="#镜像是什么">#</a> 镜像是什么</h3>
<p>镜像是一种轻量级，可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容没包括代码 运行时 库 环境变量和配置文件.<br />
 所有的应用，直接打包 docker 镜像 就可以跑起来<br />
如何得到镜像:</p>
<ul>
<li>从 douckerHub 下载</li>
<li>自己制作一个镜像 DockerFile</li>
</ul>
<h3 id="镜像加载原理"><a class="anchor" href="#镜像加载原理">#</a> 镜像加载原理</h3>
<blockquote>
<p>UnionFS (联合文件系统)<br />
 UnionFS: 联合文件系统是一种分层，轻量级并且高性能的文件系统。它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下. UnionFS 是 Docker 镜像的基础，镜像可以通过分层来进行继承，基于基础镜像 (没有父镜像), 可以制作各种具体的应用镜像.<br />
 特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录.</p>
</blockquote>
<blockquote>
<p>Docker 镜像加载原理<br />
 Docker 的镜像实际上由一层层的文件系统组成，这种文件系统就是 UnionFS.<br />
<strong>bootfs</strong> (boot file system) 主要包含 bootloader 和 kernel, bootloader 主要是引导加载 kernel,Linux 刚启动时会加载 bootfs 文件系统，在 Docker 镜像的最底层是 bootfs, 这一层与我们典型的 Linux/Unix 系统是一样的，包含 boot 加载器和内核。当 boot 加载完成之后，整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 bootfs.<br />
<strong>rootfs</strong> (root file system) 在 bootfs 之上，包含的就是典型 Linux 系统中的 /dev , /proc, /bin, /etc 等标准目录和文件. rootfs 就是各种不同的操作系统发行版，比如 Ubuntu,Centos 等等.</p>
</blockquote>
<p>对于一个精简的 OS,rootfs 可以很小，只需包含基本的命令，工具和库就可以了。因为底层直接使用宿主机的 kernel , 自己只需要提供 rootfs 就可以。由此可见 对于不同的 linux 发行版，bootfs 基本是一致的，rootfs 会有差别，因此不同的发行版可以公用 bootfs.</p>
<p>而 docker 就是公用了宿主机的 bootfs, 镜像中只加载 rootfs 所包含的内容。所以镜像可以做到很小，并且秒级启动.</p>
<blockquote>
<p>Docker 镜像理解<br />
所有的 Docker 镜像都起始于一个基础镜像层，当进行修改或者增加新的内容时，就会在当前镜像层之上 创建新的镜像层.<br />
 在添加额外镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要</p>
</blockquote>
<blockquote>
<p>特点<br />
 Docker 镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部。这一层就是我们通常说的容器层，容器之下的都叫镜像层<br />
 ==&gt; docker run 的时候，运行的镜像层 就是在 pull 下来的镜像层基础上再添加一层用户镜像组合成的</p>
</blockquote>
<h3 id="commit-镜像"><a class="anchor" href="#commit-镜像">#</a> Commit 镜像</h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker commit 提交容器称为一个新的镜像副本</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 提交命令和 git 类似</span></pre></td></tr><tr><td data-num="3"></td><td><pre>docker commit -m<span class="token operator">=</span><span class="token string">"提交描述信息"</span> -a<span class="token operator">=</span><span class="token string">"作者"</span> 容器 <span class="token function">id</span> 目标镜像名:<span class="token punctuation">[</span>版本<span class="token punctuation">]</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 启动一个默认的 tomcat, 官方镜像在 webapps 下面是没有任何文件的！！</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 将 webapps.dist 中的基本文件递归拷贝到 webapps 中</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 提交自己更改过的镜像</span></pre></td></tr><tr><td data-num="4"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker commit -a="oldfun" -m="add webapps application" tomcat01 tomcat02:1.0</span></pre></td></tr><tr><td data-num="5"></td><td><pre>sha256:5f4cd782012b5300643b31319f13fc0e9a585438b39b3e48070eb839e89acd9a</pre></td></tr><tr><td data-num="6"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="7"></td><td><pre>REPOSITORY             TAG       IMAGE ID       CREATED          SIZE</pre></td></tr><tr><td data-num="8"></td><td><pre>tomcat02               <span class="token number">1.0</span>       5f4cd782012b   <span class="token number">22</span> seconds ago   684MB</pre></td></tr><tr><td data-num="9"></td><td><pre>elasticsearch          <span class="token number">7.17</span>.0    6fe993d6e7ed   <span class="token number">2</span> weeks ago      612MB</pre></td></tr><tr><td data-num="10"></td><td><pre>nginx                  latest    605c77e624dd   <span class="token number">6</span> weeks ago      141MB</pre></td></tr><tr><td data-num="11"></td><td><pre>tomcat                 latest    fb5657adc892   <span class="token number">7</span> weeks ago      680MB</pre></td></tr><tr><td data-num="12"></td><td><pre>hello-world            latest    feb5d9fea6a5   <span class="token number">4</span> months ago     <span class="token number">13</span>.3kB</pre></td></tr><tr><td data-num="13"></td><td><pre>codercom/code-server   latest    08823d73807e   <span class="token number">5</span> months ago     <span class="token number">1</span>.11GB</pre></td></tr><tr><td data-num="14"></td><td><pre>centos                 latest    5d0da3dc9764   <span class="token number">5</span> months ago     231MB</pre></td></tr><tr><td data-num="15"></td><td><pre>portainer/portainer    latest    580c0e4e98b0   <span class="token number">11</span> months ago    <span class="token number">79</span>.1MB</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 上面的 tomcat02 镜像，就是基于之前的 tomcat 官方镜像更改提交的，</span></pre></td></tr><tr><td data-num="18"></td><td><pre>提交到本地,可以类比 Linux 的快照概念</pre></td></tr></table></figure><h2 id="容器数据卷"><a class="anchor" href="#容器数据卷">#</a> 容器数据卷</h2>
<h3 id="什么是数据卷"><a class="anchor" href="#什么是数据卷">#</a> 什么是数据卷</h3>
<p><strong>docker 的理念回顾</strong><br />
 docker 理念是将应用和环境打包成一个镜像，<br />
 那么数据呢？如果数据都在容器中，那么我们容器一删除 数据就会丢失了！<br />
 数据需要可以持久化！</p>
<blockquote>
<p>Docker 需要提供数据可以存储在本地的能力，才能真正满足实际生产的需要！！<br />
Docker 的容器数据卷 就是支持数据共享，将容器中产生的数据 同步到本地的技术.<br />
 本质是进行目录的挂载，将容器内的目录 挂载到 Linux 上面</p>
</blockquote>
<h3 id="使用数据卷"><a class="anchor" href="#使用数据卷">#</a> 使用数据卷</h3>
<p>方式一：直接使用命令来挂载 -v</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker run -it -v  主机绝对目录:容器内目录  镜像名</pre></td></tr></table></figure><p><img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/1644897896507.png" alt="docker inspect 容器 id" /></p>
<p><strong>查看容器挂载信息，可以发现 docer 是从宿主机向容器内进行的挂载</strong><br />
数据卷的挂载是双向的，对于宿主机或者容器内的数据改变 都会同步 (但是这种同步并不是将两个文件系统进行同步，而是更类似于磁盘映射，不管是宿主机还是容器内 写的都是同一个磁盘，文件在操作系统里面，容器中的文件 相当于一个快捷方式)</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 查看 docker 挂载</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker inspect 容器id</pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"Mounts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"bind"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/home/centos_docker"</span>,</pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"/home"</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token string">"RW"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">"rprivate"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">]</span>,</pre></td></tr></table></figure><p><strong>注：即使是容器停止了，在宿主机上修改文件后 再次启动容器查看内容 依然是同步的！</strong></p>
<p><strong>将容器删除后，挂载的数据卷中数据也不会被删除</strong></p>
<p>(类比容器读取宿主机快捷方式来理解)</p>
<h3 id="实战-mysql同步数据"><a class="anchor" href="#实战-mysql同步数据">#</a> 实战: MySQL 同步数据</h3>
<p>关于数据同步的内存占用:</p>
<p>因为数据卷的同步类似于快捷方式，所以对内存的占用不会跟多，不会因为同步造成两倍数据量.</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># docker pull mysql</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 后台运行 mysql 并配置数据卷同步</span></pre></td></tr><tr><td data-num="4"></td><td><pre>-d 后台运行</pre></td></tr><tr><td data-num="5"></td><td><pre>-p 端口映射</pre></td></tr><tr><td data-num="6"></td><td><pre>-v 数据卷挂载</pre></td></tr><tr><td data-num="7"></td><td><pre>-e 环境配置</pre></td></tr><tr><td data-num="8"></td><td><pre>--name 容器名字</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker run -d -p 3310:3306 -v /home/mysql_docker/conf:/etc/mysql/conf.d -v /home/mysql_docker/data:/var/lib/mysql  --name mysql01 -e MYSQL_ROOT_PASSWORD=aA123456  mysql</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 使用 navicat 连接后创建新的数据库，在服务器查看 /home/mysql_docker/data</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 会发现多出来自己创建的 testDocker 数据库 (证明数据同步成功)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>root@VM-16-11-ubuntu:/home/mysql_docker<span class="token comment"># cd data</span></pre></td></tr><tr><td data-num="15"></td><td><pre>root@VM-16-11-ubuntu:/home/mysql_docker/data<span class="token comment"># ls</span></pre></td></tr><tr><td data-num="16"></td><td><pre> auto.cnf        ca.pem               ib_buffer_pool  <span class="token string">'#innodb_temp'</span>        public_key.pem    undo_001</pre></td></tr><tr><td data-num="17"></td><td><pre> binlog.000001   client-cert.pem      ibdata1          mysql                server-cert.pem   undo_002</pre></td></tr><tr><td data-num="18"></td><td><pre> binlog.000002   client-key.pem       ib_logfile0      mysql.ibd            server-key.pem</pre></td></tr><tr><td data-num="19"></td><td><pre> binlog.index   <span class="token string">'#ib_16384_0.dblwr'</span>   ib_logfile1      performance_schema   sys</pre></td></tr><tr><td data-num="20"></td><td><pre> ca-key.pem     <span class="token string">'#ib_16384_1.dblwr'</span>   ibtmp1           private_key.pem      testDocker</pre></td></tr></table></figure><h3 id="具名挂载和匿名挂载"><a class="anchor" href="#具名挂载和匿名挂载">#</a> 具名挂载和匿名挂载</h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 匿名挂载</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># -v 容器内文件路径！！</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 使用匿名挂载的方式配置 nginx</span></pre></td></tr><tr><td data-num="4"></td><td><pre>docker run -d --name nginx01 -v /etc/nginx nginx</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 查看所有的 volume 情况</span></pre></td></tr><tr><td data-num="7"></td><td><pre>docker volume <span class="token function">ls</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 具名挂载，注意这里使用的不是主机绝对路径！！</span></pre></td></tr><tr><td data-num="10"></td><td><pre> docker run -d --name nginx02 -v juming-nginx:/etc/nginx nginx</pre></td></tr><tr><td data-num="11"></td><td><pre>root@VM-16-11-ubuntu:/home/mysql_docker/data<span class="token comment"># docker volume ls</span></pre></td></tr><tr><td data-num="12"></td><td><pre>DRIVER    VOLUME NAME</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token builtin class-name">local</span>     d954327e7d8538751730238a6b96f34b8e49d569d1a558b31cbd609f9069ff46</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token builtin class-name">local</span>     juming-nginx</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 查看挂载具体信息</span></pre></td></tr><tr><td data-num="17"></td><td><pre>docker volume inspect 卷名/hashID</pre></td></tr><tr><td data-num="18"></td><td><pre>root@VM-16-11-ubuntu:/home/mysql_docker/data<span class="token comment"># docker volume inspect juming-nginx</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token string">"CreatedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-15T16:15:23+08:00"</span>,</pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token string">"Mountpoint"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/juming-nginx/_data"</span>,</pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"juming-nginx"</span>,</pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p><strong>所有 docker 容器的卷，在没有指定目录的情况下 都是在 /var/lib/docker/volumes 下！</strong></p>
<p>我们通过具名挂载，可以很方便的找到卷。大多数情况下 使用的都是具名挂载</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 如何确定是具名挂载，匿名挂载；还是指定路径挂载</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>-v 容器内路径 							<span class="token comment"># 匿名挂载</span></pre></td></tr><tr><td data-num="4"></td><td><pre>-v 卷名:容器内路径				  <span class="token comment"># 具名挂载</span></pre></td></tr><tr><td data-num="5"></td><td><pre>-v /宿主机路径:容器内路径		<span class="token comment"># 指定路径挂载</span></pre></td></tr></table></figure><p>拓展:</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 通过 -v 容器内路径:ro rw , 可以改变读写权限！</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ro <span class="token punctuation">(</span>readonly<span class="token punctuation">)</span>     <span class="token comment"># 只读</span></pre></td></tr><tr><td data-num="3"></td><td><pre>re <span class="token punctuation">(</span>readwrite<span class="token punctuation">)</span>    <span class="token comment"># 可读可写</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 一旦设定了容器权限，我们挂载出来的卷 在容器中就会有权限限定了. </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 如果设置 ro 这个目录就只能从外部宿主机改变；默认是 rw 的权限</span></pre></td></tr><tr><td data-num="7"></td><td><pre>docker run -d --name nginx02 -v juming-nginx:/etc/nginx:ro nginx</pre></td></tr><tr><td data-num="8"></td><td><pre>docker run -d --name nginx02 -v juming-nginx:/etc/nginx:rw nginx</pre></td></tr></table></figure><h3 id="初识dockerfile"><a class="anchor" href="#初识dockerfile">#</a> 初识 DockerFile</h3>
<p>Dockerfile 就是用来构建 docker 镜像的构建文件，是一个 docker 执行的命令脚本</p>
<p>通过这个脚本，可以生成镜像。镜像是一层一层的，脚本一个个的命令 每个命令都是一层</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># docker build -f dockerfile 文件来源 (绝对或相对路径) -t 输出的目标镜像：版本号 .(在当前目录)</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 1. 创建一个 dockerfile 文件</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 文件中的内容：指令 (大写)  参数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>FROM centos</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>VOLUME <span class="token punctuation">[</span><span class="token string">"volume01"</span>,<span class="token string">"volume02"</span><span class="token punctuation">]</span>  <span class="token comment"># 匿名挂载</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>CMD <span class="token builtin class-name">echo</span> <span class="token string">"---end---"</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>CMD /bin/bash</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 这里的每个命令，就是镜像的一层</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 2. 根据这个文件进行镜像构建</span></pre></td></tr><tr><td data-num="16"></td><td><pre>root@VM-16-11-ubuntu:/home/docker-test-volume<span class="token comment"># docker build -f dockerfile -t oldfun/centos:0.1 .</span></pre></td></tr><tr><td data-num="17"></td><td><pre>Sending build context to Docker daemon  <span class="token number">2</span>.048kB</pre></td></tr><tr><td data-num="18"></td><td><pre>Step <span class="token number">1</span>/4 <span class="token builtin class-name">:</span> FROM centos</pre></td></tr><tr><td data-num="19"></td><td><pre> ---<span class="token operator">></span> 5d0da3dc9764</pre></td></tr><tr><td data-num="20"></td><td><pre>Step <span class="token number">2</span>/4 <span class="token builtin class-name">:</span> VOLUME <span class="token punctuation">[</span><span class="token string">"volume01"</span>,<span class="token string">"volume02"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="21"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> b63f6e771e8c</pre></td></tr><tr><td data-num="22"></td><td><pre>Removing intermediate container b63f6e771e8c</pre></td></tr><tr><td data-num="23"></td><td><pre> ---<span class="token operator">></span> 9883ed60937f</pre></td></tr><tr><td data-num="24"></td><td><pre>Step <span class="token number">3</span>/4 <span class="token builtin class-name">:</span> CMD <span class="token builtin class-name">echo</span> <span class="token string">"---end---"</span></pre></td></tr><tr><td data-num="25"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 2f29b7862ca6</pre></td></tr><tr><td data-num="26"></td><td><pre>Removing intermediate container 2f29b7862ca6</pre></td></tr><tr><td data-num="27"></td><td><pre> ---<span class="token operator">></span> fb3a94937f16</pre></td></tr><tr><td data-num="28"></td><td><pre>Step <span class="token number">4</span>/4 <span class="token builtin class-name">:</span> CMD /bin/bash</pre></td></tr><tr><td data-num="29"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 654246dc599d</pre></td></tr><tr><td data-num="30"></td><td><pre>Removing intermediate container 654246dc599d</pre></td></tr><tr><td data-num="31"></td><td><pre> ---<span class="token operator">></span> 25405bfe3738</pre></td></tr><tr><td data-num="32"></td><td><pre>Successfully built 25405bfe3738</pre></td></tr><tr><td data-num="33"></td><td><pre>Successfully tagged oldfun/centos:0.1</pre></td></tr><tr><td data-num="34"></td><td><pre>root@VM-16-11-ubuntu:/home/docker-test-volume<span class="token comment"># docker images</span></pre></td></tr><tr><td data-num="35"></td><td><pre>REPOSITORY             TAG       IMAGE ID       CREATED          SIZE</pre></td></tr><tr><td data-num="36"></td><td><pre>oldfun/centos          <span class="token number">0.1</span>       25405bfe3738   <span class="token number">16</span> seconds ago   231MB</pre></td></tr><tr><td data-num="37"></td><td><pre>tomcat02               <span class="token number">1.0</span>       5f4cd782012b   <span class="token number">23</span> hours ago     684MB</pre></td></tr><tr><td data-num="38"></td><td><pre>elasticsearch          <span class="token number">7.17</span>.0    6fe993d6e7ed   <span class="token number">2</span> weeks ago      612MB</pre></td></tr><tr><td data-num="39"></td><td><pre>nginx                  latest    605c77e624dd   <span class="token number">6</span> weeks ago      141MB</pre></td></tr><tr><td data-num="40"></td><td><pre>tomcat                 latest    fb5657adc892   <span class="token number">7</span> weeks ago      680MB</pre></td></tr><tr><td data-num="41"></td><td><pre>mysql                  latest    3218b38490ce   <span class="token number">8</span> weeks ago      516MB</pre></td></tr><tr><td data-num="42"></td><td><pre>hello-world            latest    feb5d9fea6a5   <span class="token number">4</span> months ago     <span class="token number">13</span>.3kB</pre></td></tr><tr><td data-num="43"></td><td><pre>codercom/code-server   latest    08823d73807e   <span class="token number">5</span> months ago     <span class="token number">1</span>.11GB</pre></td></tr><tr><td data-num="44"></td><td><pre>centos                 latest    5d0da3dc9764   <span class="token number">5</span> months ago     231MB</pre></td></tr><tr><td data-num="45"></td><td><pre>portainer/portainer    latest    580c0e4e98b0   <span class="token number">11</span> months ago    <span class="token number">79</span>.1MB</pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 尝试运行自己写的 dockerfile 镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker run -it oldfun/centos:0.1 <span class="token function">bash</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@87c537a64e72 /<span class="token punctuation">]</span><span class="token comment"># ls -l</span></pre></td></tr><tr><td data-num="5"></td><td><pre>total <span class="token number">56</span></pre></td></tr><tr><td data-num="6"></td><td><pre>lrwxrwxrwx   <span class="token number">1</span> root root    <span class="token number">7</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> bin -<span class="token operator">></span> usr/bin</pre></td></tr><tr><td data-num="7"></td><td><pre>drwxr-xr-x   <span class="token number">5</span> root root  <span class="token number">360</span> Feb <span class="token number">15</span> 09:00 dev</pre></td></tr><tr><td data-num="8"></td><td><pre>drwxr-xr-x   <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">15</span> 09:00 etc</pre></td></tr><tr><td data-num="9"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> home</pre></td></tr><tr><td data-num="10"></td><td><pre>lrwxrwxrwx   <span class="token number">1</span> root root    <span class="token number">7</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> lib -<span class="token operator">></span> usr/lib</pre></td></tr><tr><td data-num="11"></td><td><pre>lrwxrwxrwx   <span class="token number">1</span> root root    <span class="token number">9</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> lib64 -<span class="token operator">></span> usr/lib64</pre></td></tr><tr><td data-num="12"></td><td><pre>drwx------   <span class="token number">2</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 lost+found</pre></td></tr><tr><td data-num="13"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> media</pre></td></tr><tr><td data-num="14"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> mnt</pre></td></tr><tr><td data-num="15"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> opt</pre></td></tr><tr><td data-num="16"></td><td><pre>dr-xr-xr-x <span class="token number">239</span> root root    <span class="token number">0</span> Feb <span class="token number">15</span> 09:00 proc</pre></td></tr><tr><td data-num="17"></td><td><pre>dr-xr-x---   <span class="token number">2</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 root</pre></td></tr><tr><td data-num="18"></td><td><pre>drwxr-xr-x  <span class="token number">11</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 run</pre></td></tr><tr><td data-num="19"></td><td><pre>lrwxrwxrwx   <span class="token number">1</span> root root    <span class="token number">8</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> sbin -<span class="token operator">></span> usr/sbin</pre></td></tr><tr><td data-num="20"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> srv</pre></td></tr><tr><td data-num="21"></td><td><pre>dr-xr-xr-x  <span class="token number">13</span> root root    <span class="token number">0</span> Feb <span class="token number">15</span> 09:00 sys</pre></td></tr><tr><td data-num="22"></td><td><pre>drwxrwxrwt   <span class="token number">7</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 tmp</pre></td></tr><tr><td data-num="23"></td><td><pre>drwxr-xr-x  <span class="token number">12</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 usr</pre></td></tr><tr><td data-num="24"></td><td><pre>drwxr-xr-x  <span class="token number">20</span> root root <span class="token number">4096</span> Sep <span class="token number">15</span> <span class="token number">14</span>:17 var</pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 这里的目录就是生成镜像时自动挂载的 数据卷目录.</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment"># dockerfile 使用的是匿名挂载，所以容器内 volume01/02 的数据 </span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 会同步在默认的位置 /var/lib/docker/volumes 下</span></pre></td></tr><tr><td data-num="28"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Feb <span class="token number">15</span> 09:00 volume01</pre></td></tr><tr><td data-num="29"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Feb <span class="token number">15</span> 09:00 volume02</pre></td></tr></table></figure><h3 id="数据卷容器"><a class="anchor" href="#数据卷容器">#</a> 数据卷容器</h3>
<p>容器之间同步数据的方法，例如 实现多个 mysql 的数据同步</p>
<p>利用 A 容器 作为<strong>父容器</strong>，另一个 B 容器从 A 容器挂载数据卷，即可实现多个容器之间的数据共享.</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>--volumes -from </pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 启动 2 个容器 测试</span></pre></td></tr><tr><td data-num="4"></td><td><pre>docker run -it --name docker01 oldfun/centos:0.1 </pre></td></tr><tr><td data-num="5"></td><td><pre> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 启动第二个容器挂载到 docker01</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># --volumes-from , 类似 java 中的 extend 一样</span></pre></td></tr><tr><td data-num="8"></td><td><pre>docker run -it --name docker03 --volumes-from docker01 centos</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 虽然使用的官方 centos 但是指定的挂载按照自定义的 centos 来 所以也是存在 volume01/02 这两个共享文件</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@56032dd30937 /<span class="token punctuation">]</span><span class="token comment"># ls</span></pre></td></tr><tr><td data-num="12"></td><td><pre>bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01  volume02</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment"># 即使删除了容器 docker01 ,02 依旧可以访问这个文件！</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 从下述的 docker 详情中也可以发现，实际上在使用 --volume-from 之后，三个容器的卷最终指向的都是宿主机上同一个目录，挂载到相同的匿名数据卷下！</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># docker inspect docker01</span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token string">"Mounts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"volume"</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"565c179aaf6d24708deea72f0a9e0e87297b6dc4f759b00d2a5a6c28eb7b36e4"</span>,</pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/565c179aaf6d24708deea72f0a9e0e87297b6dc4f759b00d2a5a6c28eb7b36e4/_data"</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"volume01"</span>,</pre></td></tr><tr><td data-num="24"></td><td><pre>                <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token string">"RW"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"volume"</span>,</pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"8f643b06096c9941ff21ccb85372fe1f3e5874ed54a3bc84bf32eaa179ffeefc"</span>,</pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/8f643b06096c9941ff21ccb85372fe1f3e5874ed54a3bc84bf32eaa179ffeefc/_data"</span>,</pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"volume02"</span>,</pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token string">"RW"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token comment"># docker inspect docker02</span></pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token string">"Mounts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"volume"</span>,</pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"565c179aaf6d24708deea72f0a9e0e87297b6dc4f759b00d2a5a6c28eb7b36e4"</span>,</pre></td></tr><tr><td data-num="47"></td><td><pre>                <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/565c179aaf6d24708deea72f0a9e0e87297b6dc4f759b00d2a5a6c28eb7b36e4/_data"</span>,</pre></td></tr><tr><td data-num="48"></td><td><pre>                <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"volume01"</span>,</pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="50"></td><td><pre>                <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token string">"RW"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="54"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"volume"</span>,</pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"8f643b06096c9941ff21ccb85372fe1f3e5874ed54a3bc84bf32eaa179ffeefc"</span>,</pre></td></tr><tr><td data-num="57"></td><td><pre>                <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/var/lib/docker/volumes/8f643b06096c9941ff21ccb85372fe1f3e5874ed54a3bc84bf32eaa179ffeefc/_data"</span>,</pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"volume02"</span>,</pre></td></tr><tr><td data-num="59"></td><td><pre>                <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="60"></td><td><pre>                <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="61"></td><td><pre>                <span class="token string">"RW"</span><span class="token builtin class-name">:</span> true,</pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="63"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token punctuation">]</span>,</pre></td></tr></table></figure><p><strong>小结</strong></p>
<p>容器之间配置信息的传递，数据同步都可以使用数据卷容器来实现。数据卷容器的声明周期一直持续到没有容器使用为止.</p>
<p>但是一旦持久化到额本地，这个时候 本地数据是不会删除的</p>
<h2 id="dockerfile"><a class="anchor" href="#dockerfile">#</a> DockerFile</h2>
<h3 id="简介"><a class="anchor" href="#简介">#</a> 简介</h3>
<p>dockerfile 是用来构建 docker 镜像的文件，是一个命令参数的脚本</p>
<p>构建步骤:</p>
<ol>
<li>
<p>编写一个 dockerfile 文件</p>
</li>
<li>
<p>docker build 构建为一个镜像</p>
</li>
<li>
<p>docker run 运行镜像</p>
</li>
<li>
<p>docker push 发布镜像 (dockerHub / 闭源镜像仓库)</p>
</li>
</ol>
<p>dockerHub 上的镜像 也是由官方创建的 dockerfile 构建而来的</p>
<p>点击 Supported tags and respective  <code>Dockerfile</code>  links , 在 dockerhub 官网即可查看 dockerfile 内容:</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 以官方 centos 为例:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM scratch</pre></td></tr><tr><td data-num="3"></td><td><pre>ADD centos-7-x86_64-docker.tar.xz /</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>LABEL <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    org.label-schema.schema-version<span class="token operator">=</span><span class="token string">"1.0"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    org.label-schema.name<span class="token operator">=</span><span class="token string">"CentOS Base Image"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    org.label-schema.vendor<span class="token operator">=</span><span class="token string">"CentOS"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    org.label-schema.license<span class="token operator">=</span><span class="token string">"GPLv2"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    org.label-schema.build-date<span class="token operator">=</span><span class="token string">"20201113"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    org.opencontainers.image.title<span class="token operator">=</span><span class="token string">"CentOS Base Image"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    org.opencontainers.image.vendor<span class="token operator">=</span><span class="token string">"CentOS"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    org.opencontainers.image.licenses<span class="token operator">=</span><span class="token string">"GPL-2.0-only"</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    org.opencontainers.image.created<span class="token operator">=</span><span class="token string">"2020-11-13 00:00:00+00:00"</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>CMD <span class="token punctuation">[</span><span class="token string">"/bin/bash"</span><span class="token punctuation">]</span></pre></td></tr></table></figure><h3 id="dockerfile构建过程"><a class="anchor" href="#dockerfile构建过程">#</a> DockerFile 构建过程</h3>
<p><strong>基础知识</strong></p>
<ol>
<li>每个保留关键字 (指令) 都是大写字母</li>
<li>指令是从上到下 顺序执行</li>
<li><code>#</code>  表示注释</li>
<li>每一个指令都会创建一个新的镜像层，并提交</li>
</ol>
<p>dockerfile 是面向开发的，我们以后要发布项目，做镜像 就需要编写 dockerfile 文件.</p>
<p>Docker 镜像逐渐成为企业交付的标准！</p>
<p>DockerFile:  构建文件 定义了一切的步骤，相当于源代码</p>
<p>DockerImages:  通过 DockerFile 构建生成的镜像，最终发布和运行产品</p>
<p>Docker 容器：容器就是镜像运行起来 通过服务的</p>
<h3 id="dockerfile的指令"><a class="anchor" href="#dockerfile的指令">#</a> DockerFile 的指令</h3>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>FROM						<span class="token comment"># 基础镜像，一切从这里开始构建</span></pre></td></tr><tr><td data-num="2"></td><td><pre>MAINTAINER			<span class="token comment"># 镜像是谁写的，一般默认 姓名 + 邮箱</span></pre></td></tr><tr><td data-num="3"></td><td><pre>RUN							<span class="token comment"># 镜像构建的时候，需要运行的命令</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ADD							<span class="token comment"># 步骤，添加的压缩包内容 (会自动解压！！)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>WORKDIR				  <span class="token comment"># 镜像的工作目录</span></pre></td></tr><tr><td data-num="6"></td><td><pre>VOLUME					<span class="token comment"># 挂载的目录</span></pre></td></tr><tr><td data-num="7"></td><td><pre>EXPOST					<span class="token comment"># 暴露端口的配置</span></pre></td></tr><tr><td data-num="8"></td><td><pre>CMD							<span class="token comment"># 指定这个容器启动的时候要运行的命令，只有最后一个会生效！！可被替代</span></pre></td></tr><tr><td data-num="9"></td><td><pre>ENTRYPOINT		 <span class="token comment"># 指定这个容器启动的时候要运行的命令，可以追加命令</span></pre></td></tr><tr><td data-num="10"></td><td><pre>ONBUILD				 <span class="token comment"># 当构建一个被继承的 DockerFile 这个时候才会执行 ONBUILD 指令；(特殊指令，它后面跟的是其他指令 入 RUN COPY 等，而这些指令在当前镜像构件式并不会被执行。只有当以当前镜像为基础镜像去构建下一级镜像时 才会执行)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>COPY					  <span class="token comment"># 类似 ADD, 将我们的文件拷贝到镜像中</span></pre></td></tr><tr><td data-num="12"></td><td><pre>ENV							<span class="token comment">#	构建的时候设置环境变量</span></pre></td></tr></table></figure><p><mark><strong>注意: Docker build 时，镜像名称不能含有大写字母！！</strong></mark></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f myCentosDockerFile -t myCentos:0.1 .</span></pre></td></tr><tr><td data-num="2"></td><td><pre>invalid argument <span class="token string">"myCentos:0.1"</span> <span class="token keyword">for</span> <span class="token string">"-t, --tag"</span> flag: invalid reference format: repository name must be lowercase</pre></td></tr><tr><td data-num="3"></td><td><pre>See <span class="token string">'docker build --help'</span><span class="token builtin class-name">.</span></pre></td></tr></table></figure><p><mark><strong>注意: ADD 和 COPY 指令的路径，不能使用相对路径或 dockerfile 所在目录之外的文件目录！！</strong></mark></p>
<p>详见:</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3OTYwNjAzL2FydGljbGUvZGV0YWlscy8xMTEyMjAyNDE/c3BtPTEwMzUuMjAyMy4zMDAxLjY1NTcmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19yZWxldmFudF9iYnNfZG93bl92Mi5ub25lLXRhc2stYmxvZy0yfmRlZmF1bHR+T1BFTlNFQVJDSH5SYXRlLTIucGNfcmVsZXZhbnRfYmJzX2Rvd25fdjJfZGVmYXVsdCZhbXA7ZGVwdGhfMS11dG1fc291cmNlPWRpc3RyaWJ1dGUucGNfcmVsZXZhbnRfYmJzX2Rvd25fdjIubm9uZS10YXNrLWJsb2ctMn5kZWZhdWx0fk9QRU5TRUFSQ0h+UmF0ZS0yLnBjX3JlbGV2YW50X2Jic19kb3duX3YyX2RlZmF1bHQ=">Docker - Dockerfile 之 ADD、COPY、WORKDIR、USER、EXPOSE 指令详解</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3OTYwNjAzL2FydGljbGUvZGV0YWlscy8xMTEyMjAyNDE/c3BtPTEwMzUuMjAyMy4zMDAxLjY1NTcmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19yZWxldmFudF9iYnNfZG93bl92Mi5ub25lLXRhc2stYmxvZy0yfmRlZmF1bHR+T1BFTlNFQVJDSH5SYXRlLTIucGNfcmVsZXZhbnRfYmJzX2Rvd25fdjJfZGVmYXVsdCZhbXA7ZGVwdGhfMS11dG1fc291cmNlPWRpc3RyaWJ1dGUucGNfcmVsZXZhbnRfYmJzX2Rvd25fdjIubm9uZS10YXNrLWJsb2ctMn5kZWZhdWx0fk9QRU5TRUFSQ0h+UmF0ZS0yLnBjX3JlbGV2YW50X2Jic19kb3duX3YyX2RlZmF1bHQ="></span></p>
<hr />
<blockquote>
<p>Docker Hub 中，99% 的镜像都是以 scratch 为基础镜像构建，然后配置需要的软件和配置 .</p>
<p>scratch 镜像是一个空镜像，不能执行 pull 或者 run</p>
</blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS9fL3NjcmF0Y2g/dGFiPWRlc2NyaXB0aW9u">scratch 的 dockerHub 解释</span></p>
<p><strong>实战测试</strong></p>
<p>创建 dockerfile</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 以 centos 官方镜像为基础</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM centos</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 添加作者邮箱</span></pre></td></tr><tr><td data-num="4"></td><td><pre>MAINTAINER oldfun<span class="token operator">&lt;</span><span class="token number">759547916</span>@qq.com<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 配置环境变量</span></pre></td></tr><tr><td data-num="7"></td><td><pre>ENV MYPATH /usr/local</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 设置工作目录</span></pre></td></tr><tr><td data-num="9"></td><td><pre>WORKDIR <span class="token variable">$MYPATH</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 执行指令</span></pre></td></tr><tr><td data-num="12"></td><td><pre>RUN yun -y <span class="token function">install</span> <span class="token function">vim</span></pre></td></tr><tr><td data-num="13"></td><td><pre>RUN yun -y <span class="token function">install</span> net-tools</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="16"></td><td><pre>EXPOSE <span class="token number">80</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span></pre></td></tr><tr><td data-num="19"></td><td><pre>CMD <span class="token builtin class-name">echo</span> <span class="token string">"---end---"</span></pre></td></tr><tr><td data-num="20"></td><td><pre>CMD /bin/bash</pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 注意：镜像名称不能有大写！！</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f myCentosDockerFile -t myCentos:0.1 .</span></pre></td></tr><tr><td data-num="3"></td><td><pre>invalid argument <span class="token string">"myCentos:0.1"</span> <span class="token keyword">for</span> <span class="token string">"-t, --tag"</span> flag: invalid reference format: repository name must be lowercase</pre></td></tr><tr><td data-num="4"></td><td><pre>See <span class="token string">'docker build --help'</span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 构建自定义镜像</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 注意: -t [tag] . 表示 build 依赖的 context 为当前目录，一般情况下不用更改。也可设置为其他的目录路径</span></pre></td></tr><tr><td data-num="8"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f myCentosDockerFile -t mycentos:0.1 .</span></pre></td></tr><tr><td data-num="9"></td><td><pre>Sending build context to Docker daemon  <span class="token number">2</span>.048kB</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 会复用已经存在的基础镜像</span></pre></td></tr><tr><td data-num="11"></td><td><pre>Step <span class="token number">1</span>/10 <span class="token builtin class-name">:</span> FROM centos</pre></td></tr><tr><td data-num="12"></td><td><pre> ---<span class="token operator">></span> 5d0da3dc9764</pre></td></tr><tr><td data-num="13"></td><td><pre>Step <span class="token number">2</span>/10 <span class="token builtin class-name">:</span> MAINTAINER oldfun<span class="token operator">&lt;</span><span class="token number">759547916</span>@qq.com<span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 710435d21081</pre></td></tr><tr><td data-num="15"></td><td><pre>Removing intermediate container 710435d21081</pre></td></tr><tr><td data-num="16"></td><td><pre> ---<span class="token operator">></span> be7a1c24c55a</pre></td></tr><tr><td data-num="17"></td><td><pre>Step <span class="token number">3</span>/10 <span class="token builtin class-name">:</span> ENV MYPATH /usr/local</pre></td></tr><tr><td data-num="18"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> d82b6d0f26a5</pre></td></tr><tr><td data-num="19"></td><td><pre>Removing intermediate container d82b6d0f26a5</pre></td></tr><tr><td data-num="20"></td><td><pre> ---<span class="token operator">></span> 250665db798f</pre></td></tr><tr><td data-num="21"></td><td><pre>Step <span class="token number">4</span>/10 <span class="token builtin class-name">:</span> WORKDIR <span class="token variable">$MYPATH</span></pre></td></tr><tr><td data-num="22"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> be6cdb53d23b</pre></td></tr><tr><td data-num="23"></td><td><pre>Removing intermediate container be6cdb53d23b</pre></td></tr><tr><td data-num="24"></td><td><pre> ---<span class="token operator">></span> 9bfe8d713d76</pre></td></tr><tr><td data-num="25"></td><td><pre> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token comment"># 使用官方 centos 镜像，最新版本为 8 对于 yum 的下载需要重新设置 yum 镜像！！</span></pre></td></tr><tr><td data-num="27"></td><td><pre>Step <span class="token number">5</span>/10 <span class="token builtin class-name">:</span> RUN yum -y <span class="token function">install</span> <span class="token function">vim</span></pre></td></tr><tr><td data-num="28"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> b31ab2b22e21</pre></td></tr><tr><td data-num="29"></td><td><pre>CentOS Linux <span class="token number">8</span> - AppStream                       <span class="token number">38</span>  B/s <span class="token operator">|</span>  <span class="token number">38</span>  B     00:00    </pre></td></tr><tr><td data-num="30"></td><td><pre>Error: Failed to download metadata <span class="token keyword">for</span> repo <span class="token string">'appstream'</span><span class="token builtin class-name">:</span> Cannot prepare internal mirrorlist: No URLs <span class="token keyword">in</span> mirrorlist</pre></td></tr><tr><td data-num="31"></td><td><pre>The <span class="token builtin class-name">command</span> <span class="token string">'/bin/sh -c yum -y install vim'</span> returned a non-zero code: <span class="token number">1</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment"># 更改上述自定义 dockerfile, 设置基础镜像为 centos7</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>FROM centos:7</pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f myCentosDockerFile -t mycentos:0.1 .</span></pre></td></tr><tr><td data-num="38"></td><td><pre>Sending build context to Docker daemon  <span class="token number">2</span>.048kB</pre></td></tr><tr><td data-num="39"></td><td><pre>Step <span class="token number">1</span>/10 <span class="token builtin class-name">:</span> FROM centos7</pre></td></tr><tr><td data-num="40"></td><td><pre>^C</pre></td></tr><tr><td data-num="41"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f myCentosDockerFile -t mycentos:0.1 .</span></pre></td></tr><tr><td data-num="42"></td><td><pre>Sending build context to Docker daemon  <span class="token number">2</span>.048kB</pre></td></tr><tr><td data-num="43"></td><td><pre>Step <span class="token number">1</span>/10 <span class="token builtin class-name">:</span> FROM centos:7</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token number">7</span>: Pulling from library/centos</pre></td></tr><tr><td data-num="45"></td><td><pre>2d473b07cdd5: Pull complete </pre></td></tr><tr><td data-num="46"></td><td><pre>Digest: sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987</pre></td></tr><tr><td data-num="47"></td><td><pre>Status: Downloaded newer image <span class="token keyword">for</span> centos:7</pre></td></tr><tr><td data-num="48"></td><td><pre> ---<span class="token operator">></span> eeb6ee3f44bd</pre></td></tr><tr><td data-num="49"></td><td><pre>Step <span class="token number">2</span>/10 <span class="token builtin class-name">:</span> MAINTAINER oldfun<span class="token operator">&lt;</span><span class="token number">759547916</span>@qq.com<span class="token operator">></span></pre></td></tr><tr><td data-num="50"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 9fdcaeffdd2e</pre></td></tr><tr><td data-num="51"></td><td><pre>Removing intermediate container 9fdcaeffdd2e</pre></td></tr><tr><td data-num="52"></td><td><pre> ---<span class="token operator">></span> 57595319591b</pre></td></tr><tr><td data-num="53"></td><td><pre>Step <span class="token number">3</span>/10 <span class="token builtin class-name">:</span> ENV MYPATH /usr/local</pre></td></tr><tr><td data-num="54"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 060bc934d09f</pre></td></tr><tr><td data-num="55"></td><td><pre>Removing intermediate container 060bc934d09f</pre></td></tr><tr><td data-num="56"></td><td><pre> ---<span class="token operator">></span> 56d4069a718b</pre></td></tr><tr><td data-num="57"></td><td><pre>Step <span class="token number">4</span>/10 <span class="token builtin class-name">:</span> WORKDIR <span class="token variable">$MYPATH</span></pre></td></tr><tr><td data-num="58"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 20643e287f31</pre></td></tr><tr><td data-num="59"></td><td><pre>Removing intermediate container 20643e287f31</pre></td></tr><tr><td data-num="60"></td><td><pre> ---<span class="token operator">></span> eebb36afd6f1</pre></td></tr><tr><td data-num="61"></td><td><pre>Step <span class="token number">5</span>/10 <span class="token builtin class-name">:</span> RUN yum -y <span class="token function">install</span> <span class="token function">vim</span></pre></td></tr><tr><td data-num="62"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 7be5477f3b8d</pre></td></tr><tr><td data-num="63"></td><td><pre>Loaded plugins: fastestmirror, ovl</pre></td></tr><tr><td data-num="64"></td><td><pre>Determining fastest mirrors</pre></td></tr><tr><td data-num="65"></td><td><pre> * base: mirrors.nju.edu.cn</pre></td></tr><tr><td data-num="66"></td><td><pre> * extras: mirrors.njupt.edu.cn</pre></td></tr><tr><td data-num="67"></td><td><pre> * updates: mirrors.nju.edu.cn</pre></td></tr><tr><td data-num="68"></td><td><pre>Resolving Dependencies</pre></td></tr><tr><td data-num="69"></td><td><pre>--<span class="token operator">></span> Running transaction check</pre></td></tr><tr><td data-num="70"></td><td><pre>---<span class="token operator">></span> Package vim-enhanced.x86_64 <span class="token number">2</span>:7.4.629-8.el7_9 will be installed</pre></td></tr><tr><td data-num="71"></td><td><pre>--<span class="token operator">></span> Processing Dependency: vim-common <span class="token operator">=</span> <span class="token number">2</span>:7.4.629-8.el7_9 <span class="token keyword">for</span> package: <span class="token number">2</span>:vim-enhanced-7.4.629-8.el7_9.x86_64</pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="73"></td><td><pre>--<span class="token operator">></span> Running transaction check</pre></td></tr><tr><td data-num="74"></td><td><pre>---<span class="token operator">></span> Package groff-base.x86_64 <span class="token number">0</span>:1.22.2-8.el7 will be installed</pre></td></tr><tr><td data-num="75"></td><td><pre>---<span class="token operator">></span> Package perl-HTTP-Tiny.noarch <span class="token number">0</span>:0.033-3.el7 will be installed</pre></td></tr><tr><td data-num="76"></td><td><pre>---<span class="token operator">></span> Package perl-parent.noarch <span class="token number">1</span>:0.225-244.el7 will be installed</pre></td></tr><tr><td data-num="77"></td><td><pre>--<span class="token operator">></span> Finished Dependency Resolution</pre></td></tr><tr><td data-num="78"></td><td><pre></pre></td></tr><tr><td data-num="79"></td><td><pre>Dependencies Resolved</pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="82"></td><td><pre> Package                    Arch       Version                Repository   Size</pre></td></tr><tr><td data-num="83"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="84"></td><td><pre>Installing:</pre></td></tr><tr><td data-num="85"></td><td><pre> vim-enhanced               x86_64     <span class="token number">2</span>:7.4.629-8.el7_9      updates     <span class="token number">1.1</span> M</pre></td></tr><tr><td data-num="86"></td><td><pre>Installing <span class="token keyword">for</span> dependencies:</pre></td></tr><tr><td data-num="87"></td><td><pre> gpm-libs                   x86_64     <span class="token number">1.20</span>.7-6.el7           base         <span class="token number">32</span> k</pre></td></tr><tr><td data-num="88"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="89"></td><td><pre> <span class="token function">which</span>                      x86_64     <span class="token number">2.20</span>-7.el7             base         <span class="token number">41</span> k</pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre>Transaction Summary</pre></td></tr><tr><td data-num="92"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="93"></td><td><pre>Install  <span class="token number">1</span> Package <span class="token punctuation">(</span>+32 Dependent packages<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="94"></td><td><pre></pre></td></tr><tr><td data-num="95"></td><td><pre>Total download size: <span class="token number">19</span> M</pre></td></tr><tr><td data-num="96"></td><td><pre>Installed size: <span class="token number">63</span> M</pre></td></tr><tr><td data-num="97"></td><td><pre>Downloading packages:</pre></td></tr><tr><td data-num="98"></td><td><pre>warning: /var/cache/yum/x86_64/7/base/packages/gpm-libs-1.20.7-6.el7.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID f4a80eb5: NOKEY</pre></td></tr><tr><td data-num="99"></td><td><pre>Public key <span class="token keyword">for</span> gpm-libs-1.20.7-6.el7.x86_64.rpm is not installed</pre></td></tr><tr><td data-num="100"></td><td><pre>Public key <span class="token keyword">for</span> perl-5.16.3-299.el7_9.x86_64.rpm is not installed</pre></td></tr><tr><td data-num="101"></td><td><pre>--------------------------------------------------------------------------------</pre></td></tr><tr><td data-num="102"></td><td><pre>Total                                               <span class="token number">10</span> MB/s <span class="token operator">|</span>  <span class="token number">19</span> MB  00:01     </pre></td></tr><tr><td data-num="103"></td><td><pre>Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</pre></td></tr><tr><td data-num="104"></td><td><pre>Importing GPG key 0xF4A80EB5:</pre></td></tr><tr><td data-num="105"></td><td><pre> Userid     <span class="token builtin class-name">:</span> <span class="token string">"CentOS-7 Key (CentOS 7 Official Signing Key) &lt;security@centos.org>"</span></pre></td></tr><tr><td data-num="106"></td><td><pre> Fingerprint: <span class="token number">6341</span> ab27 53d7 8a78 a7c2 7bb1 24c6 a8a7 f4a8 0eb5</pre></td></tr><tr><td data-num="107"></td><td><pre> Package    <span class="token builtin class-name">:</span> centos-release-7-9.2009.0.el7.centos.x86_64 <span class="token punctuation">(</span>@CentOS<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="108"></td><td><pre> From       <span class="token builtin class-name">:</span> /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</pre></td></tr><tr><td data-num="109"></td><td><pre>Running transaction check</pre></td></tr><tr><td data-num="110"></td><td><pre>Running transaction <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="111"></td><td><pre>Transaction <span class="token builtin class-name">test</span> succeeded</pre></td></tr><tr><td data-num="112"></td><td><pre>Running transaction</pre></td></tr><tr><td data-num="113"></td><td><pre>  Installing <span class="token builtin class-name">:</span> gpm-libs-1.20.7-6.el7.x86_64                                <span class="token number">1</span>/33 </pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="115"></td><td><pre>  Installing <span class="token builtin class-name">:</span> <span class="token number">2</span>:vim-enhanced-7.4.629-8.el7_9.x86_64                      <span class="token number">33</span>/33 </pre></td></tr><tr><td data-num="116"></td><td><pre>  Verifying  <span class="token builtin class-name">:</span> perl-HTTP-Tiny-0.033-3.el7.noarch                           <span class="token number">1</span>/33 </pre></td></tr><tr><td data-num="117"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="118"></td><td><pre>  Verifying  <span class="token builtin class-name">:</span> perl-Text-ParseWords-3.29-4.el7.noarch                     <span class="token number">32</span>/33 </pre></td></tr><tr><td data-num="119"></td><td><pre>  Verifying  <span class="token builtin class-name">:</span> <span class="token number">4</span>:perl-libs-5.16.3-299.el7_9.x86_64                        <span class="token number">33</span>/33 </pre></td></tr><tr><td data-num="120"></td><td><pre></pre></td></tr><tr><td data-num="121"></td><td><pre>Installed:</pre></td></tr><tr><td data-num="122"></td><td><pre>  vim-enhanced.x86_64 <span class="token number">2</span>:7.4.629-8.el7_9                                         </pre></td></tr><tr><td data-num="123"></td><td><pre></pre></td></tr><tr><td data-num="124"></td><td><pre>Dependency Installed:</pre></td></tr><tr><td data-num="125"></td><td><pre>  gpm-libs.x86_64 <span class="token number">0</span>:1.20.7-6.el7                                                </pre></td></tr><tr><td data-num="126"></td><td><pre><span class="token punctuation">..</span>.                                                                   </pre></td></tr><tr><td data-num="127"></td><td><pre>  vim-filesystem.x86_64 <span class="token number">2</span>:7.4.629-8.el7_9                                       </pre></td></tr><tr><td data-num="128"></td><td><pre>  which.x86_64 <span class="token number">0</span>:2.20-7.el7                                                     </pre></td></tr><tr><td data-num="129"></td><td><pre></pre></td></tr><tr><td data-num="130"></td><td><pre>Complete<span class="token operator">!</span></pre></td></tr><tr><td data-num="131"></td><td><pre>Removing intermediate container 7be5477f3b8d</pre></td></tr><tr><td data-num="132"></td><td><pre> ---<span class="token operator">></span> 5cc520fec374</pre></td></tr><tr><td data-num="133"></td><td><pre>Step <span class="token number">6</span>/10 <span class="token builtin class-name">:</span> RUN yum -y <span class="token function">install</span> net-tools</pre></td></tr><tr><td data-num="134"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 0d6e555d7047</pre></td></tr><tr><td data-num="135"></td><td><pre>Loaded plugins: fastestmirror, ovl</pre></td></tr><tr><td data-num="136"></td><td><pre>Loading mirror speeds from cached hostfile</pre></td></tr><tr><td data-num="137"></td><td><pre> * base: mirrors.nju.edu.cn</pre></td></tr><tr><td data-num="138"></td><td><pre> * extras: mirrors.njupt.edu.cn</pre></td></tr><tr><td data-num="139"></td><td><pre> * updates: mirrors.nju.edu.cn</pre></td></tr><tr><td data-num="140"></td><td><pre>Resolving Dependencies</pre></td></tr><tr><td data-num="141"></td><td><pre>--<span class="token operator">></span> Running transaction check</pre></td></tr><tr><td data-num="142"></td><td><pre>---<span class="token operator">></span> Package net-tools.x86_64 <span class="token number">0</span>:2.0-0.25.20131004git.el7 will be installed</pre></td></tr><tr><td data-num="143"></td><td><pre>--<span class="token operator">></span> Finished Dependency Resolution</pre></td></tr><tr><td data-num="144"></td><td><pre></pre></td></tr><tr><td data-num="145"></td><td><pre>Dependencies Resolved</pre></td></tr><tr><td data-num="146"></td><td><pre></pre></td></tr><tr><td data-num="147"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="148"></td><td><pre> Package         Arch         Version                          Repository  Size</pre></td></tr><tr><td data-num="149"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="150"></td><td><pre>Installing:</pre></td></tr><tr><td data-num="151"></td><td><pre> net-tools       x86_64       <span class="token number">2.0</span>-0.25.20131004git.el7         base       <span class="token number">306</span> k</pre></td></tr><tr><td data-num="152"></td><td><pre></pre></td></tr><tr><td data-num="153"></td><td><pre>Transaction Summary</pre></td></tr><tr><td data-num="154"></td><td><pre><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></pre></td></tr><tr><td data-num="155"></td><td><pre>Install  <span class="token number">1</span> Package</pre></td></tr><tr><td data-num="156"></td><td><pre></pre></td></tr><tr><td data-num="157"></td><td><pre>Total download size: <span class="token number">306</span> k</pre></td></tr><tr><td data-num="158"></td><td><pre>Installed size: <span class="token number">917</span> k</pre></td></tr><tr><td data-num="159"></td><td><pre>Downloading packages:</pre></td></tr><tr><td data-num="160"></td><td><pre>Running transaction check</pre></td></tr><tr><td data-num="161"></td><td><pre>Running transaction <span class="token builtin class-name">test</span></pre></td></tr><tr><td data-num="162"></td><td><pre>Transaction <span class="token builtin class-name">test</span> succeeded</pre></td></tr><tr><td data-num="163"></td><td><pre>Running transaction</pre></td></tr><tr><td data-num="164"></td><td><pre>  Installing <span class="token builtin class-name">:</span> net-tools-2.0-0.25.20131004git.el7.x86_64                    <span class="token number">1</span>/1 </pre></td></tr><tr><td data-num="165"></td><td><pre>  Verifying  <span class="token builtin class-name">:</span> net-tools-2.0-0.25.20131004git.el7.x86_64                    <span class="token number">1</span>/1 </pre></td></tr><tr><td data-num="166"></td><td><pre></pre></td></tr><tr><td data-num="167"></td><td><pre>Installed:</pre></td></tr><tr><td data-num="168"></td><td><pre>  net-tools.x86_64 <span class="token number">0</span>:2.0-0.25.20131004git.el7                                   </pre></td></tr><tr><td data-num="169"></td><td><pre></pre></td></tr><tr><td data-num="170"></td><td><pre>Complete<span class="token operator">!</span></pre></td></tr><tr><td data-num="171"></td><td><pre>Removing intermediate container 0d6e555d7047</pre></td></tr><tr><td data-num="172"></td><td><pre> ---<span class="token operator">></span> e2b969bdb52d</pre></td></tr><tr><td data-num="173"></td><td><pre>Step <span class="token number">7</span>/10 <span class="token builtin class-name">:</span> EXPOSE <span class="token number">80</span></pre></td></tr><tr><td data-num="174"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> f9c9d29250de</pre></td></tr><tr><td data-num="175"></td><td><pre>Removing intermediate container f9c9d29250de</pre></td></tr><tr><td data-num="176"></td><td><pre> ---<span class="token operator">></span> ce0dd293f645</pre></td></tr><tr><td data-num="177"></td><td><pre>Step <span class="token number">8</span>/10 <span class="token builtin class-name">:</span> CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span></pre></td></tr><tr><td data-num="178"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 080a05ea8326</pre></td></tr><tr><td data-num="179"></td><td><pre>Removing intermediate container 080a05ea8326</pre></td></tr><tr><td data-num="180"></td><td><pre> ---<span class="token operator">></span> 51eddfaa7da5</pre></td></tr><tr><td data-num="181"></td><td><pre>Step <span class="token number">9</span>/10 <span class="token builtin class-name">:</span> CMD <span class="token builtin class-name">echo</span> <span class="token string">"---end---"</span></pre></td></tr><tr><td data-num="182"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 1ba3582cca15</pre></td></tr><tr><td data-num="183"></td><td><pre>Removing intermediate container 1ba3582cca15</pre></td></tr><tr><td data-num="184"></td><td><pre> ---<span class="token operator">></span> c6302cbd316b</pre></td></tr><tr><td data-num="185"></td><td><pre>Step <span class="token number">10</span>/10 <span class="token builtin class-name">:</span> CMD /bin/bash</pre></td></tr><tr><td data-num="186"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 25f8bb3a77d0</pre></td></tr><tr><td data-num="187"></td><td><pre>Removing intermediate container 25f8bb3a77d0</pre></td></tr><tr><td data-num="188"></td><td><pre> ---<span class="token operator">></span> 4d2690bcbd36</pre></td></tr><tr><td data-num="189"></td><td><pre>Successfully built 4d2690bcbd36</pre></td></tr><tr><td data-num="190"></td><td><pre>Successfully tagged mycentos:0.1</pre></td></tr><tr><td data-num="191"></td><td><pre></pre></td></tr><tr><td data-num="192"></td><td><pre><span class="token comment"># 验证 dockerfile 中设置的 WORKDIR</span></pre></td></tr><tr><td data-num="193"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker run -it mycentos:0.1</span></pre></td></tr><tr><td data-num="194"></td><td><pre><span class="token punctuation">[</span>root@f8f57b1c3d15 local<span class="token punctuation">]</span><span class="token comment"># pwd</span></pre></td></tr><tr><td data-num="195"></td><td><pre>/usr/local</pre></td></tr><tr><td data-num="196"></td><td><pre></pre></td></tr><tr><td data-num="197"></td><td><pre><span class="token comment"># 尝试使用 vim ifconfig 等命令也可以执行</span></pre></td></tr><tr><td data-num="198"></td><td><pre><span class="token punctuation">[</span>root@f8f57b1c3d15 local<span class="token punctuation">]</span><span class="token comment"># vim</span></pre></td></tr><tr><td data-num="199"></td><td><pre><span class="token punctuation">[</span>root@f8f57b1c3d15 local<span class="token punctuation">]</span><span class="token comment"># ifconfig</span></pre></td></tr><tr><td data-num="200"></td><td><pre>eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span></pre></td></tr><tr><td data-num="201"></td><td><pre>        inet <span class="token number">172.17</span>.0.4  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255</pre></td></tr><tr><td data-num="202"></td><td><pre>        ether 02:42:ac:11:00:04  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="203"></td><td><pre>        RX packets <span class="token number">10</span>  bytes <span class="token number">796</span> <span class="token punctuation">(</span><span class="token number">796.0</span> B<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="204"></td><td><pre>        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="205"></td><td><pre>        TX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="206"></td><td><pre>        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr><tr><td data-num="207"></td><td><pre></pre></td></tr><tr><td data-num="208"></td><td><pre>lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">></span>  mtu <span class="token number">65536</span></pre></td></tr><tr><td data-num="209"></td><td><pre>        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0</pre></td></tr><tr><td data-num="210"></td><td><pre>        loop  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="211"></td><td><pre>        RX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="212"></td><td><pre>        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span></pre></td></tr><tr><td data-num="213"></td><td><pre>        TX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="214"></td><td><pre>        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 指定在当前路径下 (/Users/apple) build 镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>master  <span class="token function">sudo</span> docker build -f /Users/apple/Documents/blog/dockerfile   -t shoka/hexo:0.1 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Password:</pre></td></tr><tr><td data-num="4"></td><td><pre>error checking context: <span class="token string">'no permission to read from '</span>/Users/apple/Documents/OneDrive/OneDrive - Microsoft/mbb/资料/电子书/C++/C++ Primer 中英版/C++  Primer中文版  第5版 <span class="token punctuation">[</span>（美）李普曼，（美）拉乔伊，（美）默著<span class="token punctuation">]</span><span class="token punctuation">[</span>电子工业出版社<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2013.08</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">838</span>页<span class="token punctuation">]</span>.pdf<span class="token string">''</span><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 更改 build 镜像的 context 路径</span></pre></td></tr><tr><td data-num="7"></td><td><pre>master  <span class="token function">sudo</span> docker build -f /Users/apple/Documents/blog/dockerfile   -t shoka/hexo:0.1 /Users/apple/Documents/blog/</pre></td></tr><tr><td data-num="8"></td><td><pre>Sending build context to Docker daemon  <span class="token number">234</span>.5MB</pre></td></tr><tr><td data-num="9"></td><td><pre>Step <span class="token number">1</span>/9 <span class="token builtin class-name">:</span> FROM node:latest</pre></td></tr><tr><td data-num="10"></td><td><pre>latest: Pulling from library/node</pre></td></tr><tr><td data-num="11"></td><td><pre>e4d61adff207: Pull complete </pre></td></tr><tr><td data-num="12"></td><td><pre>4ff1945c672b: Pull complete </pre></td></tr><tr><td data-num="13"></td><td><pre>ff5b10aec998: Pull complete </pre></td></tr><tr><td data-num="14"></td><td><pre>12de8c754e45: Pull complete </pre></td></tr><tr><td data-num="15"></td><td><pre>ada1762e7602: Downloading  <span class="token number">76</span>.36MB/196.5MB</pre></td></tr><tr><td data-num="16"></td><td><pre>6d1aaa85aab9: Download complete </pre></td></tr><tr><td data-num="17"></td><td><pre>a238e70d0a8a: Downloading  <span class="token number">29</span>.03MB/44.23MB</pre></td></tr></table></figure><h3 id="变更历史查看"><a class="anchor" href="#变更历史查看">#</a> 变更历史查看</h3>
<p>可以使用 <code>docker history</code>  指令 列出本地进行的变更历史</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker history mycentos:0.1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT</pre></td></tr><tr><td data-num="3"></td><td><pre>4d2690bcbd36   <span class="token number">20</span> minutes ago   /bin/sh -c <span class="token comment">#(nop)  CMD ["/bin/sh" "-c" "/bin…   0B        </span></pre></td></tr><tr><td data-num="4"></td><td><pre>c6302cbd316b   <span class="token number">20</span> minutes ago   /bin/sh -c <span class="token comment">#(nop)  CMD ["/bin/sh" "-c" "echo…   0B        </span></pre></td></tr><tr><td data-num="5"></td><td><pre>51eddfaa7da5   <span class="token number">20</span> minutes ago   /bin/sh -c <span class="token comment">#(nop)  CMD ["/bin/sh" "-c" "echo…   0B        </span></pre></td></tr><tr><td data-num="6"></td><td><pre>ce0dd293f645   <span class="token number">20</span> minutes ago   /bin/sh -c <span class="token comment">#(nop)  EXPOSE 80                    0B        </span></pre></td></tr><tr><td data-num="7"></td><td><pre>e2b969bdb52d   <span class="token number">20</span> minutes ago   /bin/sh -c yum -y <span class="token function">install</span> net-tools             156MB     </pre></td></tr><tr><td data-num="8"></td><td><pre>5cc520fec374   <span class="token number">20</span> minutes ago   /bin/sh -c yum -y <span class="token function">install</span> <span class="token function">vim</span>                   211MB     </pre></td></tr><tr><td data-num="9"></td><td><pre>eebb36afd6f1   <span class="token number">20</span> minutes ago   /bin/sh -c <span class="token comment">#(nop) WORKDIR /usr/local            0B        </span></pre></td></tr><tr><td data-num="10"></td><td><pre>56d4069a718b   <span class="token number">20</span> minutes ago   /bin/sh -c <span class="token comment">#(nop)  ENV MYPATH=/usr/local        0B        </span></pre></td></tr><tr><td data-num="11"></td><td><pre>57595319591b   <span class="token number">20</span> minutes ago   /bin/sh -c <span class="token comment">#(nop)  MAINTAINER oldfun&lt;7595479…   0B        </span></pre></td></tr><tr><td data-num="12"></td><td><pre>eeb6ee3f44bd   <span class="token number">5</span> months ago     /bin/sh -c <span class="token comment">#(nop)  CMD ["/bin/bash"]            0B        </span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">&lt;</span>missing<span class="token operator">></span>      <span class="token number">5</span> months ago     /bin/sh -c <span class="token comment">#(nop)  LABEL org.label-schema.sc…   0B        </span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">&lt;</span>missing<span class="token operator">></span>      <span class="token number">5</span> months ago     /bin/sh -c <span class="token comment">#(nop) ADD file:b3ebbe8bd304723d4…   204MB</span></pre></td></tr></table></figure><h3 id="cmd与entrypoint"><a class="anchor" href="#cmd与entrypoint">#</a> CMD 与 ENTRYPOINT</h3>
<blockquote>
<p>CMD					# 指定这个容器启动时要运行的命令，只有最后一个会生效。可被替代</p>
<p>ENTRYPOINT 	 # 指定这个容器启动时要运行的命令，可以追加命令</p>
</blockquote>
<p><strong>测试 CMD</strong></p>
<pre><code class="language-SHELL"># 编写dockerfile
root@VM-16-11-ubuntu:/home/docker/dockerfiles# vim dockerfile-cmd-test
FROM centos
CMD [&quot;ls&quot;,&quot;-a&quot;]

# 构建镜像
root@VM-16-11-ubuntu:/home/docker/dockerfiles# docker build -f dockerfile-cmd-test -t cmdtest .
Sending build context to Docker daemon  10.24kB
Step 1/2 : FROM centos
 ---&gt; 5d0da3dc9764
Step 2/2 : CMD [&quot;ls&quot;,&quot;-a&quot;]
 ---&gt; Running in 9ee3ded4b191
Removing intermediate container 9ee3ded4b191
 ---&gt; 7b59cc8cf24b
Successfully built 7b59cc8cf24b
Successfully tagged cmdtest:latest


# 运行镜像,ls -a 命令生效
root@VM-16-11-ubuntu:/home/docker/dockerfiles# docker run 7b59cc8cf24b
.
..
.dockerenv
bin
dev
etc
home
lib
lib64

# 尝试追加命令 -l
root@VM-16-11-ubuntu:/home/docker/dockerfiles# docker run 7b59cc8cf24b -l
docker: Error response from daemon: failed to create shim: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.
ERRO[0000] error waiting for container: context canceled 


# dockerfile使用cmd的情况下, 替换了CMD [&quot;ls&quot;,&quot;-a&quot;]命令 , 执行-l 不是一个命令 ,所以会报错
root@VM-16-11-ubuntu:/home/docker/dockerfiles# docker run 7b59cc8cf24b ls -al
total 56
drwxr-xr-x   1 root root 4096 Feb 17 12:41 .
drwxr-xr-x   1 root root 4096 Feb 17 12:41 ..
-rwxr-xr-x   1 root root    0 Feb 17 12:41 .dockerenv
lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin
drwxr-xr-x   5 root root  340 Feb 17 12:41 dev
drwxr-xr-x   1 root root 4096 Feb 17 12:41 etc
drwxr-xr-x   2 root root 4096 Nov  3  2020 home
lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib
lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64


# 测试CMD只执行最后一个命令

# 编写dockerfile
root@VM-16-11-ubuntu:/home/docker/dockerfiles# vim dockerfile-cmd-test
FROM centos
CMD [&quot;ls&quot;,&quot;-a&quot;]
CMD &quot;pwd&quot;

root@VM-16-11-ubuntu:/home/docker/dockerfiles# docker build -f dockerfile-cmd-test -t cmdtest .
Sending build context to Docker daemon  10.24kB
Step 1/3 : FROM centos
 ---&gt; 5d0da3dc9764
Step 2/3 : CMD [&quot;ls&quot;,&quot;-a&quot;]
 ---&gt; Using cache
 ---&gt; 7b59cc8cf24b
Step 3/3 : CMD &quot;pwd&quot;
 ---&gt; Running in 97bba0833731
Removing intermediate container 97bba0833731
 ---&gt; bc2d63c6539a
Successfully built bc2d63c6539a
Successfully tagged cmdtest:latest
root@VM-16-11-ubuntu:/home/docker/dockerfiles# docker run bc2d63c6539a
/
root@VM-16-11-ubuntu:/home/docker/dockerfiles# 

</code></pre>
<p><strong>测试 ENTRYPOINT</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 构建 dockerfile</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># vim dockerfile-entrypoint-test</span></pre></td></tr><tr><td data-num="3"></td><td><pre>FROM centos</pre></td></tr><tr><td data-num="4"></td><td><pre>CMD <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>CMD <span class="token string">"pwd"</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 打包生成镜像 </span></pre></td></tr><tr><td data-num="8"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f dockerfile-entrypoint-test -t entrypoint-test .</span></pre></td></tr><tr><td data-num="9"></td><td><pre>Sending build context to Docker daemon  <span class="token number">11</span>.26kB</pre></td></tr><tr><td data-num="10"></td><td><pre>Step <span class="token number">1</span>/2 <span class="token builtin class-name">:</span> FROM centos</pre></td></tr><tr><td data-num="11"></td><td><pre> ---<span class="token operator">></span> 5d0da3dc9764</pre></td></tr><tr><td data-num="12"></td><td><pre>Step <span class="token number">2</span>/2 <span class="token builtin class-name">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 1a0ccb3a77cd</pre></td></tr><tr><td data-num="14"></td><td><pre>Removing intermediate container 1a0ccb3a77cd</pre></td></tr><tr><td data-num="15"></td><td><pre> ---<span class="token operator">></span> f5f35b09f40e</pre></td></tr><tr><td data-num="16"></td><td><pre>Successfully built f5f35b09f40e</pre></td></tr><tr><td data-num="17"></td><td><pre>Successfully tagged entrypoint-test:latest</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 执行镜像</span></pre></td></tr><tr><td data-num="20"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker run f5f35b09f40e</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">..</span></pre></td></tr><tr><td data-num="23"></td><td><pre>.dockerenv</pre></td></tr><tr><td data-num="24"></td><td><pre>bin</pre></td></tr><tr><td data-num="25"></td><td><pre>dev</pre></td></tr><tr><td data-num="26"></td><td><pre>etc</pre></td></tr><tr><td data-num="27"></td><td><pre>home</pre></td></tr><tr><td data-num="28"></td><td><pre>lib</pre></td></tr><tr><td data-num="29"></td><td><pre>lib64</pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment"># 测试在命令后追加执行</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token comment"># 这里与 CMD 不同，不会产生命令的替换，而是追加在后面执行</span></pre></td></tr><tr><td data-num="34"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker run f5f35b09f40e -l</span></pre></td></tr><tr><td data-num="35"></td><td><pre>total <span class="token number">56</span></pre></td></tr><tr><td data-num="36"></td><td><pre>drwxr-xr-x   <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">17</span> <span class="token number">15</span>:28 <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="37"></td><td><pre>drwxr-xr-x   <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">17</span> <span class="token number">15</span>:28 <span class="token punctuation">..</span></pre></td></tr><tr><td data-num="38"></td><td><pre>-rwxr-xr-x   <span class="token number">1</span> root root    <span class="token number">0</span> Feb <span class="token number">17</span> <span class="token number">15</span>:28 .dockerenv</pre></td></tr><tr><td data-num="39"></td><td><pre>lrwxrwxrwx   <span class="token number">1</span> root root    <span class="token number">7</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> bin -<span class="token operator">></span> usr/bin</pre></td></tr><tr><td data-num="40"></td><td><pre>drwxr-xr-x   <span class="token number">5</span> root root  <span class="token number">340</span> Feb <span class="token number">17</span> <span class="token number">15</span>:28 dev</pre></td></tr><tr><td data-num="41"></td><td><pre>drwxr-xr-x   <span class="token number">1</span> root root <span class="token number">4096</span> Feb <span class="token number">17</span> <span class="token number">15</span>:28 etc</pre></td></tr><tr><td data-num="42"></td><td><pre>drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> home</pre></td></tr><tr><td data-num="43"></td><td><pre>lrwxrwxrwx   <span class="token number">1</span> root root    <span class="token number">7</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> lib -<span class="token operator">></span> usr/lib</pre></td></tr><tr><td data-num="44"></td><td><pre>lrwxrwxrwx   <span class="token number">1</span> root root    <span class="token number">9</span> Nov  <span class="token number">3</span>  <span class="token number">2020</span> lib64 -<span class="token operator">></span> usr/lib64</pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment"># 测试 ENTRYPOINT 多个指令的执行</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token function">vim</span> dockerfile-entrypoint-test</pre></td></tr><tr><td data-num="48"></td><td><pre>FROM centos</pre></td></tr><tr><td data-num="49"></td><td><pre>ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="50"></td><td><pre>ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"pwd"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f dockerfile-entrypoint-test -t entrypoint-test .</span></pre></td></tr><tr><td data-num="53"></td><td><pre>Sending build context to Docker daemon  <span class="token number">11</span>.26kB</pre></td></tr><tr><td data-num="54"></td><td><pre>Step <span class="token number">1</span>/3 <span class="token builtin class-name">:</span> FROM centos</pre></td></tr><tr><td data-num="55"></td><td><pre> ---<span class="token operator">></span> 5d0da3dc9764</pre></td></tr><tr><td data-num="56"></td><td><pre> <span class="token comment"># 注意这里的 Using cache , 体现了 docker 镜像的分层文件系统！</span></pre></td></tr><tr><td data-num="57"></td><td><pre>Step <span class="token number">2</span>/3 <span class="token builtin class-name">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"ls"</span>,<span class="token string">"-a"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="58"></td><td><pre> ---<span class="token operator">></span> Using cache</pre></td></tr><tr><td data-num="59"></td><td><pre> ---<span class="token operator">></span> f5f35b09f40e</pre></td></tr><tr><td data-num="60"></td><td><pre>Step <span class="token number">3</span>/3 <span class="token builtin class-name">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"pwd"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="61"></td><td><pre> ---<span class="token operator">></span> Running <span class="token keyword">in</span> 50cd3d8b73d2</pre></td></tr><tr><td data-num="62"></td><td><pre>Removing intermediate container 50cd3d8b73d2</pre></td></tr><tr><td data-num="63"></td><td><pre> ---<span class="token operator">></span> 8a51e79df5d5</pre></td></tr><tr><td data-num="64"></td><td><pre>Successfully built 8a51e79df5d5</pre></td></tr><tr><td data-num="65"></td><td><pre>Successfully tagged entrypoint-test:latest</pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token comment"># 运行镜像测试，也是只能执行最后一个 ENTRYPOINT</span></pre></td></tr><tr><td data-num="68"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker run 8a51e79df5d5</span></pre></td></tr><tr><td data-num="69"></td><td><pre>/</pre></td></tr></table></figure><blockquote>
<p>docker run 中 的命令是直接替换 CMD 指定的命令与参数，使用 ENTRYPOINT 命令后，CMD 指定的命令则是作为参数列表，作为 ENTRYPOINT 命令的参数使用</p>
</blockquote>
<h3 id="实战-tomcat镜像"><a class="anchor" href="#实战-tomcat镜像">#</a> 实战: Tomcat 镜像</h3>
<hr />
<ol>
<li>准备镜像文件 : tomcat 压缩包，jdk 压缩包</li>
<li>编写 dockerfile 文件</li>
</ol>
<blockquote>
<p>Dockerfile 文件要是命名为 Dockerfile , 则在 docker build 的时候不用加 -f 就能找到文件</p>
</blockquote>
<p>1</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 编写 dockerfile</span></pre></td></tr><tr><td data-num="2"></td><td><pre>FROM centos:7</pre></td></tr><tr><td data-num="3"></td><td><pre>MAINTAINER oldfun<span class="token operator">&lt;</span><span class="token number">759547916</span>@qq.com<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 这里的 COPY 和 ADD 指令要注意路径问题！！</span></pre></td></tr><tr><td data-num="6"></td><td><pre>COPY readme.txt /usr/local/readme.txt</pre></td></tr><tr><td data-num="7"></td><td><pre>ADD jdk-8u321-linux-x64.tar.gz /usr/local</pre></td></tr><tr><td data-num="8"></td><td><pre>ADD apache-tomcat-9.0.58.tar.gz /usr/local</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>RUN yum <span class="token function">install</span> -y <span class="token function">vim</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>ENV MYPATH /usr/local</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment"># 设置工作目录</span></pre></td></tr><tr><td data-num="14"></td><td><pre>WORKDIR <span class="token variable">$MYPATH</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 设置 java 环境变量</span></pre></td></tr><tr><td data-num="17"></td><td><pre>ENV JAVA_HOME /usr/local/jdk1.8.0_321 </pre></td></tr><tr><td data-num="18"></td><td><pre>ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 设置 tomcat 环境变量</span></pre></td></tr><tr><td data-num="21"></td><td><pre>ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.58</pre></td></tr><tr><td data-num="22"></td><td><pre>ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.58</pre></td></tr><tr><td data-num="23"></td><td><pre>ENV <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/lib:<span class="token variable">$CATALINA_HOME</span>/bin</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 暴露端口</span></pre></td></tr><tr><td data-num="26"></td><td><pre>EXPOSE <span class="token number">8080</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 启动 tomcat</span></pre></td></tr><tr><td data-num="28"></td><td><pre>CMD /usr/local/apache-tomcat-9.0.58/bin/startup.sh <span class="token operator">&amp;&amp;</span> taill -F /url/local/apache-tomcat-9.0.58/bin/logs/catalina.out</pre></td></tr></table></figure><p>2  构建镜像</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 运行 docker build, 构建镜像</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f dockerfile-tomcat-my -t mytomcat .</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Sending build context to Docker daemon  <span class="token number">13</span>.82kB</pre></td></tr><tr><td data-num="4"></td><td><pre>Error response from daemon: dockerfile parse error line <span class="token number">20</span>: unknown instruction: EXPORT</pre></td></tr><tr><td data-num="5"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f dockerfile-tomcat-my -t mytomcat .</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Sending build context to Docker daemon  <span class="token number">13</span>.82kB</pre></td></tr><tr><td data-num="7"></td><td><pre>Step <span class="token number">1</span>/15 <span class="token builtin class-name">:</span> FROM centos:7</pre></td></tr><tr><td data-num="8"></td><td><pre> ---<span class="token operator">></span> eeb6ee3f44bd</pre></td></tr><tr><td data-num="9"></td><td><pre>Step <span class="token number">2</span>/15 <span class="token builtin class-name">:</span> MAINTAINER oldfun<span class="token operator">&lt;</span><span class="token number">759547916</span>@qq.com<span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre> ---<span class="token operator">></span> Using cache</pre></td></tr><tr><td data-num="11"></td><td><pre> ---<span class="token operator">></span> 57595319591b</pre></td></tr><tr><td data-num="12"></td><td><pre>Step <span class="token number">3</span>/15 <span class="token builtin class-name">:</span> COPY readme.txt /usr/local/readme.txt</pre></td></tr><tr><td data-num="13"></td><td><pre> ---<span class="token operator">></span> d3dec29794e8</pre></td></tr><tr><td data-num="14"></td><td><pre>Step <span class="token number">4</span>/15 <span class="token builtin class-name">:</span> ADD /home/docker/dockerzip/jdk-8u321-linux-x64.tar.gz /usr/local</pre></td></tr><tr><td data-num="15"></td><td><pre>ADD failed: <span class="token function">file</span> not found <span class="token keyword">in</span> build context or excluded by .dockerignore: <span class="token function">stat</span> home/docker/dockerzip/jdk-8u321-linux-x64.tar.gz: <span class="token function">file</span> does not exist</pre></td></tr><tr><td data-num="16"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerfiles<span class="token comment"># docker build -f dockerfile-tomcat-my -t mytomcat .</span></pre></td></tr><tr><td data-num="17"></td><td><pre>Sending build context to Docker daemon  <span class="token number">13</span>.82kB</pre></td></tr><tr><td data-num="18"></td><td><pre>Step <span class="token number">1</span>/15 <span class="token builtin class-name">:</span> FROM centos:7</pre></td></tr><tr><td data-num="19"></td><td><pre> ---<span class="token operator">></span> eeb6ee3f44bd</pre></td></tr><tr><td data-num="20"></td><td><pre>Step <span class="token number">2</span>/15 <span class="token builtin class-name">:</span> MAINTAINER oldfun<span class="token operator">&lt;</span><span class="token number">759547916</span>@qq.com<span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre> ---<span class="token operator">></span> Using cache</pre></td></tr><tr><td data-num="22"></td><td><pre> ---<span class="token operator">></span> 57595319591b</pre></td></tr><tr><td data-num="23"></td><td><pre>Step <span class="token number">3</span>/15 <span class="token builtin class-name">:</span> COPY readme.txt /usr/local/readme.txt</pre></td></tr><tr><td data-num="24"></td><td><pre> ---<span class="token operator">></span> Using cache</pre></td></tr><tr><td data-num="25"></td><td><pre> ---<span class="token operator">></span> d3dec29794e8</pre></td></tr><tr><td data-num="26"></td><td><pre> </pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 如果 ADD/COPY 的内容不在 dockerfile 目录下，使用相对路径 则会产生入下报错！！</span></pre></td></tr><tr><td data-num="28"></td><td><pre>Step <span class="token number">4</span>/15 <span class="token builtin class-name">:</span> ADD <span class="token punctuation">..</span>/dockerzip/jdk-8u321-linux-x64.tar.gz /usr/local</pre></td></tr><tr><td data-num="29"></td><td><pre>ADD failed: forbidden path outside the build context: <span class="token punctuation">..</span>/dockerzip/jdk-8u321-linux-x64.tar.gz <span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>3  启动镜像</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 启动自己创建的镜像，并设置端口暴露 数据卷挂载等 </span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:/home/docker/dockerzip<span class="token comment"># docker run -d -p 9090:8080 --name oldfun-tomcat -v /home/tomcat-docker/test:/usr/local/apache-tomcat-9.0.58/webapps/test -v /home/tomcat-docker/logs:/usr/local/apache-tomcat-9.0.58/logs mytomcat</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ae2589fca9e01d4e5739b12668c4d92978daf5b9e5a81504f9a326024a5f619f</pre></td></tr></table></figure><p>4  访问测试</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> localhost:9090</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 会返回 tomcat 首页的 html</span></pre></td></tr></table></figure><p>5  模拟项目发布</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 在宿主机的 test 目录下 创建 /test/index.jsp , test/WEB-INf/web.xml</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># index.jsp</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span>html<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span>head<span class="token operator">></span><span class="token operator">&lt;</span>title<span class="token operator">></span>Hello World<span class="token operator">&lt;</span>/title<span class="token operator">></span><span class="token operator">&lt;</span>/head<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>body<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>Hello World<span class="token operator">!</span><span class="token operator">&lt;</span>br/<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">&lt;</span>/body<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">&lt;</span>/html<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># web.xml  注意，web.xml 的版本可能会造成不可访问，要使用 docker 容器中运行的 tomcat 对应版本！</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">&lt;</span>web-app <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">"http://xmlns.jcp.org/xml/ns/javaee"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  xmlns:xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  xsi:schemaLocation<span class="token operator">=</span><span class="token string">"http://xmlns.jcp.org/xml/ns/javaee</pre></td></tr><tr><td data-num="14"></td><td><pre>                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"4.0"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  metadata-complete<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token operator">&lt;</span>description<span class="token operator">></span></pre></td></tr><tr><td data-num="19"></td><td><pre>      Servlet and JSP Examples.</pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token operator">&lt;</span>/description<span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token operator">&lt;</span>display-name<span class="token operator">></span>Servlet and JSP Examples<span class="token operator">&lt;</span>/display-name<span class="token operator">></span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token operator">&lt;</span>request-character-encoding<span class="token operator">></span>UTF-<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/request-character-encoding<span class="token operator">></span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token operator">&lt;</span>welcome-file-list<span class="token operator">></span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token operator">&lt;</span>welcome-file<span class="token operator">></span>index.jsp<span class="token operator">&lt;</span>/welcome-file<span class="token operator">></span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token operator">&lt;</span>/welcome-file-list<span class="token operator">></span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">&lt;</span>/web-app<span class="token operator">></span></pre></td></tr></table></figure><h3 id="发布自己的镜像"><a class="anchor" href="#发布自己的镜像">#</a> 发布自己的镜像</h3>
<ol>
<li>注册自己的 dockerHub 账号</li>
<li>在我们服务器上提交自己的镜像 (注意！！需要先进行 docker 账号的登录！)</li>
</ol>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker login --help</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Usage:  docker login <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> <span class="token punctuation">[</span>SERVER<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>Log <span class="token keyword">in</span> to a Docker registry.</pre></td></tr><tr><td data-num="6"></td><td><pre>If no server is specified, the default is defined by the daemon.</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>Options:</pre></td></tr><tr><td data-num="9"></td><td><pre>  -p, --password string   Password</pre></td></tr><tr><td data-num="10"></td><td><pre>      --password-stdin    Take the password from stdin</pre></td></tr><tr><td data-num="11"></td><td><pre>  -u, --username string   Username</pre></td></tr></table></figure><ol start="3">
<li>登录完成后，提交镜像</li>
</ol>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 注意！！不指定版本号 push 默认 push 最新版本，可能会出现提交失败</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker push oldfun/centos</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Using default tag: latest</pre></td></tr><tr><td data-num="4"></td><td><pre>The push refers to repository <span class="token punctuation">[</span>docker.io/oldfun/centos<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>tag does not exist: oldfun/centos:latest</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>docker push 镜像名:版本号</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># docker 镜像 push 时 没有添加用户名称！！push 会提示失败</span></pre></td></tr><tr><td data-num="10"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker push oldfun/centos:0.1</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 默认找 oldfun 的账号名称对应仓库！！</span></pre></td></tr><tr><td data-num="12"></td><td><pre>The push refers to repository <span class="token punctuation">[</span>docker.io/oldfun/centos<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre>74ddd0ec08fa: Preparing </pre></td></tr><tr><td data-num="14"></td><td><pre>denied: requested access to the resource is denied</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 标准的镜像名称 push</span></pre></td></tr><tr><td data-num="17"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker push owlcity2333/oldfun/centos:0.1</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># 查找的仓库名称正确，为账号名称 owlcity2333</span></pre></td></tr><tr><td data-num="19"></td><td><pre>The push refers to repository <span class="token punctuation">[</span>docker.io/owlcity2333/oldfun/centos<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 本地镜像 tag 不正确，需要修改本地镜像 tag</span></pre></td></tr><tr><td data-num="21"></td><td><pre>An image does not exist locally with the tag: owlcity2333/oldfun/centos</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment"># 修改镜像名称 </span></pre></td></tr><tr><td data-num="24"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker tag 770329f2324f owlcity2333/oldfun/centos</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker tag --help</span></pre></td></tr><tr><td data-num="27"></td><td><pre>Usage:  docker tag SOURCE_IMAGE<span class="token punctuation">[</span>:TAG<span class="token punctuation">]</span> TARGET_IMAGE<span class="token punctuation">[</span>:TAG<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="28"></td><td><pre>Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># 从 docker push 的过程也能看出，docker 上传时依然是分层的！</span></pre></td></tr><tr><td data-num="31"></td><td><pre>The push refers to repository <span class="token punctuation">[</span>docker.io/owlcity2333/mytomcat<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>4ba2cb663f37: Layer already exists </pre></td></tr><tr><td data-num="33"></td><td><pre>6dc6133c551d: Layer already exists </pre></td></tr><tr><td data-num="34"></td><td><pre>ceaac523bc4f: Layer already exists </pre></td></tr><tr><td data-num="35"></td><td><pre>6678ec7d2d53: Pushed </pre></td></tr><tr><td data-num="36"></td><td><pre>174f56854903: Layer already exists </pre></td></tr><tr><td data-num="37"></td><td><pre>latest: digest: sha256:d2963c2048a6906dd846a235abe0a7d1a24f3fc1736c299c3616dd55f183d81d size: <span class="token number">1373</span></pre></td></tr></table></figure><blockquote>
<p>注意:</p>
<ol>
<li>不指定版本号，push 默认最新版本</li>
<li><strong>push 的镜像 对于镜像名称有要求规则:dockerHub 账号名 / 镜像名：版本号</strong></li>
</ol>
<p>没有按照这个命名的镜像 需要使用 docker tag 命令更改镜像标签才能 push!!</p>
</blockquote>
<p>自己的镜像上传后，会自动根据镜像名创建仓库！</p>
<p><img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/1645512369254.png" alt="上传自定义镜像" /></p>
<h2 id="docker-流程小结"><a class="anchor" href="#docker-流程小结">#</a> Docker 流程小结</h2>
<p><img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/1645526053821.png" alt="流程小结" /></p>
<h2 id="docker-网络"><a class="anchor" href="#docker-网络">#</a> Docker 网络</h2>
<h3 id="认识docker0"><a class="anchor" href="#认识docker0">#</a> 认识 Docker0</h3>
<p>启动容器前，查看宿主机网络环境</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># ip addr</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 本机</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment"># ip 地址 (本机回环地址)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo</pre></td></tr><tr><td data-num="7"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="8"></td><td><pre>    inet6 ::1/128 scope <span class="token function">host</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="10"></td><td><pre>       </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 服务器内网</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc mq state UP group default qlen <span class="token number">1000</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    link/ether <span class="token number">52</span>:54:00:3c:fe:af brd ff:ff:ff:ff:ff:ff</pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment"># ip 地址 (腾讯云内网地址)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    inet <span class="token number">10.0</span>.16.11/22 brd <span class="token number">10.0</span>.19.255 scope global eth0</pre></td></tr><tr><td data-num="16"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="17"></td><td><pre>    inet6 fe80::5054:ff:fe3c:feaf/64 scope <span class="token function">link</span> </pre></td></tr><tr><td data-num="18"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="19"></td><td><pre>       </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># docker 的网卡</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default </pre></td></tr><tr><td data-num="22"></td><td><pre>    link/ether 02:42:d9:66:b4:a3 brd ff:ff:ff:ff:ff:ff</pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment"># ip 地址 (docker0 地址)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0</pre></td></tr><tr><td data-num="25"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="26"></td><td><pre>    inet6 fe80::42:d9ff:fe66:b4a3/64 scope <span class="token function">link</span> </pre></td></tr><tr><td data-num="27"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr></table></figure><p>查看容器内部网络环境</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 查看容器中网络配置 (tomcat 为例)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@5cdbfccc609f:~<span class="token comment"># ip addr</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</pre></td></tr><tr><td data-num="6"></td><td><pre>    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo</pre></td></tr><tr><td data-num="7"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 136: eth0@if137, 这种 ip 地址 (172.17.0.4) 就是 docker 给他分配的！</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">136</span>: eth0@if137: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default </pre></td></tr><tr><td data-num="10"></td><td><pre>    link/ether 02:42:ac:11:00:04 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    inet <span class="token number">172.17</span>.0.4/16 brd <span class="token number">172.17</span>.255.255 scope global eth0</pre></td></tr><tr><td data-num="12"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr></table></figure><p>测试宿主机和容器的网络联通</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 宿主机 ping 容器内部 ip</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># ping 172.17.0.4</span></pre></td></tr><tr><td data-num="3"></td><td><pre>PING <span class="token number">172.17</span>.0.4 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.4<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.4: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.041</span> ms</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.4: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.050</span> ms</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.4: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.046</span> ms</pre></td></tr><tr><td data-num="7"></td><td><pre>^C</pre></td></tr><tr><td data-num="8"></td><td><pre>--- <span class="token number">172.17</span>.0.4 <span class="token function">ping</span> statistics ---</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">3</span> packets transmitted, <span class="token number">3</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 2035ms</pre></td></tr><tr><td data-num="10"></td><td><pre>rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.041</span>/0.045/0.050/0.003 ms</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 容器内 ping 宿主机 docker ip</span></pre></td></tr><tr><td data-num="13"></td><td><pre>root@5cdbfccc609f:~<span class="token comment"># ping 172.17.0.1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>PING <span class="token number">172.17</span>.0.1 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.1<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.096</span> ms</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.1: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.069</span> ms</pre></td></tr><tr><td data-num="17"></td><td><pre>^C--- <span class="token number">172.17</span>.0.1 <span class="token function">ping</span> statistics ---</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">2</span> packets transmitted, <span class="token number">2</span> packets received, <span class="token number">0</span>% packet loss</pre></td></tr><tr><td data-num="19"></td><td><pre>round-trip min/avg/max/stddev <span class="token operator">=</span> <span class="token number">0.069</span>/0.083/0.096/0.000 ms</pre></td></tr></table></figure><p><strong>宿主机可以 ping 容器！！</strong></p>
<p><strong>容器也可以 ping 宿主机！！</strong></p>
<p><strong>容器之间也可以互相 ping!!</strong></p>
<blockquote>
<p>可以将 docker0 理解为一个网关，网关下的各个子 ip 间自然可以 ping 通</p>
</blockquote>
<p>启动容器后，再次查看宿主机网络状况</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># ip addr</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</pre></td></tr><tr><td data-num="4"></td><td><pre>    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo</pre></td></tr><tr><td data-num="5"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="6"></td><td><pre>    inet6 ::1/128 scope <span class="token function">host</span> </pre></td></tr><tr><td data-num="7"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc mq state UP group default qlen <span class="token number">1000</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    link/ether <span class="token number">52</span>:54:00:3c:fe:af brd ff:ff:ff:ff:ff:ff</pre></td></tr><tr><td data-num="10"></td><td><pre>    inet <span class="token number">10.0</span>.16.11/22 brd <span class="token number">10.0</span>.19.255 scope global eth0</pre></td></tr><tr><td data-num="11"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="12"></td><td><pre>    inet6 fe80::5054:ff:fe3c:feaf/64 scope <span class="token function">link</span> </pre></td></tr><tr><td data-num="13"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default </pre></td></tr><tr><td data-num="15"></td><td><pre>    link/ether 02:42:d9:66:b4:a3 brd ff:ff:ff:ff:ff:ff</pre></td></tr><tr><td data-num="16"></td><td><pre>    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0</pre></td></tr><tr><td data-num="17"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="18"></td><td><pre>    inet6 fe80::42:d9ff:fe66:b4a3/64 scope <span class="token function">link</span> </pre></td></tr><tr><td data-num="19"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 对应 docker 容器内：136: eth0@if137    </span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 启动容器，会创建一对对的网卡配置，对应 docker 容器内和宿主机上的 ip (veth-pair)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token number">137</span>: veth457f070@if136: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default </pre></td></tr><tr><td data-num="23"></td><td><pre>    link/ether ca:88:3e:05:8e:38 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">1</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    inet6 fe80::c888:3eff:fe05:8e38/64 scope <span class="token function">link</span> </pre></td></tr><tr><td data-num="25"></td><td><pre>       valid_lft forever preferred_lft forever</pre></td></tr></table></figure><blockquote>
<p>docker 如何处理容器的网络访问？？</p>
<ol>
<li>docker 会在安装后创建一个虚拟网卡 docker0 (<strong>桥接模式</strong>), 使用<strong> veth-pair</strong> 技术</li>
</ol>
<blockquote>
<p>evth-pair 就是一对虚拟设备接口，成对出现 一端连着协议，一端彼此相连.</p>
<p>正是因为有这个特性，evth-pair 可以充当一个桥梁，连接各种虚拟网络设备！</p>
</blockquote>
<ol start="2">
<li>我们每启动一个 docker 容器，docker 就会分配一对 ip 给容器</li>
<li>容器删除后，对应的 veth-pair 网桥就会相应删除</li>
</ol>
</blockquote>
<h3 id="docker-网络原理浅析"><a class="anchor" href="#docker-网络原理浅析">#</a> Docker 网络原理浅析</h3>
<h4 id="关于docker的ip划分"><a class="anchor" href="#关于docker的ip划分">#</a> 关于 Docker 的 IP 划分</h4>
<blockquote>
<p><strong>255.255.0.1/16</strong>  的意思是 IP 地址 \ 掩码长度。是子网划分的一种方法。</p>
<p>使用子网掩码划分子网后，子网内可以通信，跨子网不能通信</p>
<p>/16 就代表两位 (一位为 8 个 0 , 2 的 8 次方 / 2 的 16 次方)</p>
<p>00000000.00000000.00000000.00000000  (二进制)</p>
<p>255.255.255.255		(十进制，因为 / 16 占用两位 则 255.255.<em>.</em> 的 IP 都在一个网络)</p>
<p>大概的可用 IP 为 256*256 -0.0.0.0 -255.255.255.255</p>
</blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly96aGlkYW8uYmFpZHUuY29tL3F1ZXN0aW9uLzE1Nzg4MjEzLmh0bWw=">网络子网掩码 - 百度百科</span></p>
<p><img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/1645601779305.png" alt="" /></p>
<h4 id="docker-容器间通信"><a class="anchor" href="#docker-容器间通信">#</a> Docker 容器间通信</h4>
<p>参考下图:</p>
<p>两个容器都是依靠 docker0 这个网络来完成的通信 (容器和宿主机之间的通信也是同理！)</p>
<p>所有的容器在不指定网络的情况下，都是 docker0 来路由的，docker 会给我们的容器分配一个默认的可用 IP.</p>
<p>容器间使用 Veth-pair 桥接；docker0 和宿主机使用 NAT 直连 到宿主机的物理网卡</p>
<blockquote>
<p>Docker 中 所有的网络接口都是虚拟的 (虚拟的转发效率高)</p>
</blockquote>
<p><img data-src="https://gitee.com/oldFun/picGitee/raw/master/img/1645599464773.png" alt="Docker 网络桥接通信示意图" /></p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYmFrYXJpL3AvMTA2MTM3MTAuaHRtbA==">veth pair 详细参考文章</span></p>
<h3 id="-link"><a class="anchor" href="#-link">#</a> --Link</h3>
<p>思考:</p>
<p>因为容器的 IP 是由 docker 来随机分配，并且容器停止后 相应的网络桥接配置也会删除.</p>
<p>那么，怎么才能处理这个问题？(实际场景：微服务的容器不停止 但是配套数据库容器 IP 发生改变)</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 尝试两个容器直接 ping 不可用！</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec -it tomcat01 ping oldfun-tomcat</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ping: unknown <span class="token function">host</span></pre></td></tr></table></figure><p>--link 的使用</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 设置容器的网络关联</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker run -d -P --name tomcat03 --link tomcat01 tomcat</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 容器设置 --link 后，就可以通过容器名 ping 通 </span></pre></td></tr><tr><td data-num="5"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec -it tomcat03 ping tomcat01</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 反向通信，则不能 ping 通！！</span></pre></td></tr><tr><td data-num="8"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec -it tomcat01 ping tomcat03</span></pre></td></tr></table></figure><p>探究:</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 列出当前 docker 网络</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network ls</span></pre></td></tr><tr><td data-num="3"></td><td><pre>NETWORK ID     NAME      DRIVER    SCOPE</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># bridge 的这个 就是 docker0</span></pre></td></tr><tr><td data-num="5"></td><td><pre>5ec890936e46   bridge    bridge    <span class="token builtin class-name">local</span></pre></td></tr><tr><td data-num="6"></td><td><pre>ab988901b72d   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span></pre></td></tr><tr><td data-num="7"></td><td><pre>28bcdf127745   none      null      <span class="token builtin class-name">local</span></pre></td></tr></table></figure><p>查看 docker0 的网络配置</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network inspect 5ec890936e46</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"bridge"</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"5ec890936e46b3fb44d40e5a7b8d8583b14f0cdb2f273302aecafab1c3787a4a"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-16T23:57:53.748004199+08:00"</span>,</pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"bridge"</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"EnableIPv6"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token string">"IPAM"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string">"Options"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token comment"># 这里展示了 docker0 默认的子网掩码划分规则</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                    <span class="token string">"Subnet"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.0/16"</span>,</pre></td></tr><tr><td data-num="17"></td><td><pre>                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.1"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token string">"Internal"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token string">"Attachable"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token string">"Ingress"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token string">"ConfigFrom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token string">"Network"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token string">"ConfigOnly"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment"># 各个桥接到 docker0 的容器网络配置</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token string">"5cdbfccc609ff6755efbd51a7b148c599eee37e1b27c833ed5bc3fc0f5e565ee"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat01"</span>,</pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"24529f880ebef2cc9ada00734a329bd5628db0a8546ea895d8ac3bf6b91571b8"</span>,</pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:04"</span>,</pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.4/16"</span>,</pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token string">"aea246269aa1d1809ff2403422d681b43196b834c928cdf0a8011602daa3f204"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat03"</span>,</pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"e23247d5688f367da4d6aacc9412d6ad868d2cd730e5fe65ebde87ff98c0bace"</span>,</pre></td></tr><tr><td data-num="40"></td><td><pre>                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:05"</span>,</pre></td></tr><tr><td data-num="41"></td><td><pre>                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.5/16"</span>,</pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            <span class="token string">"com.docker.network.bridge.default_bridge"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>,</pre></td></tr><tr><td data-num="47"></td><td><pre>            <span class="token string">"com.docker.network.bridge.enable_icc"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>,</pre></td></tr><tr><td data-num="48"></td><td><pre>            <span class="token string">"com.docker.network.bridge.enable_ip_masquerade"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span>,</pre></td></tr><tr><td data-num="49"></td><td><pre>            <span class="token string">"com.docker.network.bridge.host_binding_ipv4"</span><span class="token builtin class-name">:</span> <span class="token string">"0.0.0.0"</span>,</pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token string">"com.docker.network.bridge.name"</span><span class="token builtin class-name">:</span> <span class="token string">"docker0"</span>,</pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token string">"com.docker.network.driver.mtu"</span><span class="token builtin class-name">:</span> <span class="token string">"1500"</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>Tomcat03 中设置 --link 后发生了什么？</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker inspect tomcat03 </span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token string">"HostConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token string">"Binds"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token string">"ContainerIDFile"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token string">"LogConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"json-file"</span>,</pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token string">"NetworkMode"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token string">"ExtraHosts"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string">"GroupAdd"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token string">"IpcMode"</span><span class="token builtin class-name">:</span> <span class="token string">"private"</span>,</pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token string">"Cgroup"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token comment"># tomcat03 --link tomcat01 , 在 tomcat03 的配置中 会设置上 link 相关参数</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token string">"Links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token string">"/tomcat01:/tomcat03/tomcat01"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">]</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="21"></td><td><pre>			<span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>查看 tomcat01 的网络配置</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>docker inspect tomcat01</pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token string">"HostConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token string">"Binds"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token string">"ContainerIDFile"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token string">"LogConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"json-file"</span>,</pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token string">"NetworkMode"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token string">"PortBindings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token string">"8080/tcp"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                        <span class="token string">"HostIp"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,</pre></td></tr><tr><td data-num="14"></td><td><pre>                        <span class="token string">"HostPort"</span><span class="token builtin class-name">:</span> <span class="token string">"3355"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token comment"># tomcat03 --link tomcat01 , 不会在 tomcat01 中设置相关 link 的参数 ---> link 是单向的！！</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token string">"Links"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>       <span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>佐证：查看 tomcat03 中的 hosts 配置</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec -it tomcat03 cat /etc/hosts</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">127.0</span>.0.1       localhost</pre></td></tr><tr><td data-num="3"></td><td><pre>::1     localhost ip6-localhost ip6-loopback</pre></td></tr><tr><td data-num="4"></td><td><pre>fe00::0 ip6-localnet</pre></td></tr><tr><td data-num="5"></td><td><pre>ff00::0 ip6-mcastprefix</pre></td></tr><tr><td data-num="6"></td><td><pre>ff02::1 ip6-allnodes</pre></td></tr><tr><td data-num="7"></td><td><pre>ff02::2 ip6-allrouters</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># tomcat03 --link tomcat01, 直接在 tomcat03 中配置了 tomcat01 的 IP !!</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">172.17</span>.0.4      tomcat01 5cdbfccc609f</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">172.17</span>.0.5      aea246269aa1</pre></td></tr></table></figure><blockquote>
<p>--link 本质上就是我们在容器的 hosts 配置中增加了一个 link target 对应容器的 IP (172.17.0.4      tomcat01 5cdbfccc609f)</p>
<p><strong>注意</strong>：我们现在使用 Docker 已经不建议使用 --link 来实现了！！</p>
<p>​		更好的方式是使用自定义网络而不是 docker0</p>
<p>Docker0 的问题:</p>
<p>不支持容器名来连接访问</p>
</blockquote>
<h3 id="docker网络指令"><a class="anchor" href="#docker网络指令">#</a> Docker 网络指令</h3>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3JlZmVyZW5jZS9jb21tYW5kbGluZS9uZXR3b3JrX2NyZWF0ZS8=">详见：官网 docker network create</span></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network --help</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Usage:  docker network COMMAND</pre></td></tr><tr><td data-num="3"></td><td><pre>Manage networks</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>Commands:</pre></td></tr><tr><td data-num="6"></td><td><pre>  connect     Connect a container to a network</pre></td></tr><tr><td data-num="7"></td><td><pre>  create      Create a network</pre></td></tr><tr><td data-num="8"></td><td><pre>  disconnect  Disconnect a container from a network</pre></td></tr><tr><td data-num="9"></td><td><pre>  inspect     Display detailed information on one or <span class="token function">more</span> networks</pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">ls</span>          List networks</pre></td></tr><tr><td data-num="11"></td><td><pre>  prune       Remove all unused networks</pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">rm</span>          Remove one or <span class="token function">more</span> networks</pre></td></tr></table></figure><h3 id="自定义网络"><a class="anchor" href="#自定义网络">#</a> 自定义网络</h3>
<p>docker 网络相关指令</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network --help</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>Usage:  docker network COMMAND</pre></td></tr><tr><td data-num="4"></td><td><pre>Manage networks</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>Commands:</pre></td></tr><tr><td data-num="7"></td><td><pre>  connect     Connect a container to a network</pre></td></tr><tr><td data-num="8"></td><td><pre>  create      Create a network</pre></td></tr><tr><td data-num="9"></td><td><pre>  disconnect  Disconnect a container from a network</pre></td></tr><tr><td data-num="10"></td><td><pre>  inspect     Display detailed information on one or <span class="token function">more</span> networks</pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token function">ls</span>          List networks</pre></td></tr><tr><td data-num="12"></td><td><pre>  prune       Remove all unused networks</pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">rm</span>          Remove one or <span class="token function">more</span> networks</pre></td></tr></table></figure><p>查看 docker 的所有网络</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network ls</span></pre></td></tr><tr><td data-num="2"></td><td><pre>NETWORK ID     NAME      DRIVER    SCOPE</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># docker0 </span></pre></td></tr><tr><td data-num="4"></td><td><pre>5ec890936e46   bridge    bridge    <span class="token builtin class-name">local</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>ab988901b72d   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span></pre></td></tr><tr><td data-num="7"></td><td><pre>28bcdf127745   none      null      <span class="token builtin class-name">local</span></pre></td></tr></table></figure><h4 id="docker的网络模式"><a class="anchor" href="#docker的网络模式">#</a> Docker 的网络模式</h4>
<p>bridge : 桥接网络模式 docker 的默认网络模式</p>
<p>none : 封闭网络模式，特定场景使用</p>
<p>host : 宿主网络模式，和宿主机共享网络 IP 和端口，但是<strong>容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的</strong>。</p>
<p>container : 联合挂载模式，容器内网络连通 (两个容器共享 IP)</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xNDY0NzQ0">详见：Docker 网络模式详解</span></p>
<h4 id="创建自定义网络network-create"><a class="anchor" href="#创建自定义网络network-create">#</a> 创建自定义网络 (network create)</h4>
<p>默认的 docker 容器网络配置</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 直接启动 docker 的时候，如果不指定网络 实际上会默认添加 --net bridge 来启动 docker0</span></pre></td></tr><tr><td data-num="2"></td><td><pre>docker run -d -P --name tomcat01 </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 等价于</span></pre></td></tr><tr><td data-num="4"></td><td><pre>docker run -d -P --name --net bridge tomcat01 </pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># docker0 特点：默认配置，使用容器名不能访问 (--link 可以打通，但是不建议用！)</span></pre></td></tr></table></figure><p>自定义 docker 网络</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 创建自定义网络模式</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 一定需要设置桥接模式，子网掩码规则，网关 IP, 网络名称</span></pre></td></tr><tr><td data-num="3"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network create --driver bridge --subnet 192.168.0.0/24 --gateway 192.168.0.1 mynet</span></pre></td></tr><tr><td data-num="4"></td><td><pre>e162ca3e364934f93ab73871f4fd8ae525ed95ddd86d2aade253dd60154f310c</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network ls</span></pre></td></tr><tr><td data-num="7"></td><td><pre>NETWORK ID     NAME      DRIVER    SCOPE</pre></td></tr><tr><td data-num="8"></td><td><pre>5ec890936e46   bridge    bridge    <span class="token builtin class-name">local</span></pre></td></tr><tr><td data-num="9"></td><td><pre>ab988901b72d   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 自定义网络</span></pre></td></tr><tr><td data-num="11"></td><td><pre>e162ca3e3649   mynet     bridge    <span class="token builtin class-name">local</span></pre></td></tr><tr><td data-num="12"></td><td><pre>28bcdf127745   none      null      <span class="token builtin class-name">local</span></pre></td></tr></table></figure><p>使用自定义网络启动容器</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker run -d -P --name tomcat01-mynet --net mynet tomcat</span></pre></td></tr><tr><td data-num="2"></td><td><pre>8893b0ee0f0e7079ee3c4d551918335aed6888e55fa557b62292a4963ba1b1c8</pre></td></tr><tr><td data-num="3"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker run -d -P --name tomcat02-mynet --net mynet tomcat</span></pre></td></tr><tr><td data-num="4"></td><td><pre>c0153774e5de4c0fc4ccaa3c0d9207dfbd2da373dbddc6bdc2525039989bf2c7</pre></td></tr></table></figure><p>查看自定义网络信息</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"mynet"</span>,</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"e162ca3e364934f93ab73871f4fd8ae525ed95ddd86d2aade253dd60154f310c"</span>,</pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-02-23T18:21:59.829517436+08:00"</span>,</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token string">"Scope"</span><span class="token builtin class-name">:</span> <span class="token string">"local"</span>,</pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"bridge"</span>,</pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token string">"EnableIPv6"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token string">"IPAM"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token string">"Driver"</span><span class="token builtin class-name">:</span> <span class="token string">"default"</span>,</pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                    <span class="token string">"Subnet"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.0/24"</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre>                    <span class="token string">"Gateway"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.1"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token string">"Internal"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token string">"Attachable"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token string">"Ingress"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token string">"ConfigFrom"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token string">"Network"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token string">"ConfigOnly"</span><span class="token builtin class-name">:</span> false,</pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token string">"8893b0ee0f0e7079ee3c4d551918335aed6888e55fa557b62292a4963ba1b1c8"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat01-mynet"</span>,</pre></td></tr><tr><td data-num="29"></td><td><pre>                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"db60d06dc017f30f9982956d388b73b0e84a50cb3bb90730bb64bc0f7471a3b2"</span>,</pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:02"</span>,</pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.2/24"</span>,</pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token string">"c0153774e5de4c0fc4ccaa3c0d9207dfbd2da373dbddc6bdc2525039989bf2c7"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"tomcat02-mynet"</span>,</pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"66a4101ceff4df37c110797603b1fec2afe6731aacafe7646a50be31958d56a5"</span>,</pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:03"</span>,</pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.3/24"</span>,</pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token string">"Options"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token string">"Labels"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">]</span></pre></td></tr></table></figure><p>测试容器之间通信</p>
<p>使用自定义网络，可以直接使用容器名相互通信，<strong>与使用 --link 不同 可以实现双向通信</strong></p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec -it tomcat01-mynet ping tomcat02-mynet</span></pre></td></tr><tr><td data-num="2"></td><td><pre>PING tomcat02-mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.3<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.3: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.273</span> ms</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.3: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.075</span> ms</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.3: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.075</span> ms</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec tomcat02-mynet ping tomcat01-mynet</span></pre></td></tr><tr><td data-num="8"></td><td><pre>PING tomcat01-mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">64</span> bytes from tomcat01-mynet.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.067</span> ms</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">64</span> bytes from tomcat01-mynet.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.064</span> ms</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">64</span> bytes from tomcat01-mynet.mynet <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.061</span> ms</pre></td></tr></table></figure><p>查看使用自定义网络的容器</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker inspect tomcat01-mynet</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token string">"HostConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> 				<span class="token comment"># 与 --link 不同，这里不会配置上容器名称，但是可以使用容器名 ping 通！</span></pre></td></tr><tr><td data-num="5"></td><td><pre>				<span class="token string">"Links"</span><span class="token builtin class-name">:</span> null,</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><h3 id="网络联通network-connect"><a class="anchor" href="#网络联通network-connect">#</a> 网络联通 (network connect)</h3>
<p>不同网络下的 docker 容器，在不同网段是不能直接 ping 通的.</p>
<p>想要实现上述的需求，就需要能够使容器连接到不同的网络中</p>
<blockquote>
<p>可以理解为 &quot;跨域名&quot; 了，默认的 docker0 下的 172.17 和自定义的 192.168 , 是分别划属于不同网段的，</p>
<p>如果想通信，则需要 docker0 中的容器也连接到自定义网络中才行.</p>
<p>实质上，就是实现了<strong>一个容器，多个 IP</strong>; 类似服务器可以有公网 IP 和内网 IP 一样</p>
</blockquote>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 设置使用 docker0 的容器，连通到自定义网络</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network connect mynet oldfun-tomcat</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 检查自定义网络中的配置</span></pre></td></tr><tr><td data-num="4"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network inspect mynet</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="6"></td><td><pre> 			<span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> 					<span class="token comment"># 直接将容器配置到了自定义网络中</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token string">"81c64356b37edd9abb0c41ed02fdb0a93f4e928254efca96be886d2b4cb6a37a"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"oldfun-tomcat"</span>,</pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"c355a8d2e01bd5158b0d063b7668e376aef2703ba4bbf6e477b6fe3f160d85b3"</span>,</pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:c0:a8:00:04"</span>,</pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"192.168.0.4/24"</span>,</pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">..</span>.            </pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment"># 检查 docker0 中的网络配置</span></pre></td></tr><tr><td data-num="18"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker network inspect bridge</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token string">"Containers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token string">"81c64356b37edd9abb0c41ed02fdb0a93f4e928254efca96be886d2b4cb6a37a"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token string">"Name"</span><span class="token builtin class-name">:</span> <span class="token string">"oldfun-tomcat"</span>,</pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token string">"EndpointID"</span><span class="token builtin class-name">:</span> <span class="token string">"663c2c0d59e3216f30a2d0f15c8ca6956bdf91b3b9b41562f0db9a06e138c6bd"</span>,</pre></td></tr><tr><td data-num="24"></td><td><pre>                <span class="token string">"MacAddress"</span><span class="token builtin class-name">:</span> <span class="token string">"02:42:ac:11:00:03"</span>,</pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token string">"IPv4Address"</span><span class="token builtin class-name">:</span> <span class="token string">"172.17.0.3/16"</span>,</pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token string">"IPv6Address"</span><span class="token builtin class-name">:</span> <span class="token string">""</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token punctuation">&#125;</span>,</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>测试网络的连通</p>
<figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 不同网络中，容器连通通信</span></pre></td></tr><tr><td data-num="2"></td><td><pre>root@VM-16-11-ubuntu:~<span class="token comment"># docker exec -it tomcat01-mynet ping oldfun-tomcat</span></pre></td></tr><tr><td data-num="3"></td><td><pre>PING oldfun-tomcat <span class="token punctuation">(</span><span class="token number">192.168</span>.0.4<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.4: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.306</span> ms</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">192.168</span>.0.4: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.065</span> ms</pre></td></tr></table></figure>
      <div class="tags">
          <a href="/tags/docker/" rel="tag"><i class="ic i-tag"></i> docker</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2023-03-09 01:20:59" itemprop="dateModified" datetime="2023-03-09T01:20:59+08:00">2023-03-09</time>
  </span>
  <span id="hou-duan/docker/docker-ru-men/" class="item leancloud_visitors" data-flag-title="Docker 入门 2333" title="阅读次数">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">阅读次数</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">次</span>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="别人都叫我老范 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="别人都叫我老范 支付宝">
        <p>支付宝</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="别人都叫我老范 贝宝">
        <p>贝宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>别人都叫我老范 <i class="ic i-at"><em>@</em></i>一位 Blog
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="http://adamshang2333.github.io/hou-duan/docker/docker-ru-men/" title="Docker 入门 2333">http://adamshang2333.github.io/hou-duan/docker/docker-ru-men/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/qian-duan/angular/angular-ru-men/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;oldFun&#x2F;picGitee&#x2F;raw&#x2F;master&#x2F;img&#x2F;wallhaven-3zzqy3.jpg" title="Angular入门">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Angular入门</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/hou-duan/ci-cd/ci-cd-jenkins/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;gitee.com&#x2F;oldFun&#x2F;picGitee&#x2F;raw&#x2F;master&#x2F;img&#x2F;wallhaven-zm26jw.jpg" title="CI_CD&amp;&amp;Jenkins">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> CI/CD</span>
  <h3>CI_CD&&Jenkins</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text"> Docker 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text"> Docker 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.1.1.</span> <span class="toc-text"> Docker 与虚拟机的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text"> Docker 的基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">1.2.1.</span> <span class="toc-text"> Docker 的基本组成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E5%AE%89%E8%A3%85%E4%B8%8E%E5%8D%B8%E8%BD%BD"><span class="toc-number">1.3.</span> <span class="toc-text"> Docker 安装与卸载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.1.</span> <span class="toc-text"> Docker 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E5%8D%B8%E8%BD%BD"><span class="toc-number">1.3.2.</span> <span class="toc-text"> Docker 卸载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E5%92%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text"> Docker 的启动流程和原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 底层原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.</span> <span class="toc-text"> Docker 的常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text"> 帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.2.</span> <span class="toc-text"> 镜像命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-images"><span class="toc-number">1.5.2.1.</span> <span class="toc-text"> **docker images **</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-search"><span class="toc-number">1.5.2.2.</span> <span class="toc-text"> docker search</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-pull"><span class="toc-number">1.5.2.3.</span> <span class="toc-text"> docker pull</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-rmi"><span class="toc-number">1.5.2.4.</span> <span class="toc-text"> docker rmi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-tag"><span class="toc-number">1.5.2.5.</span> <span class="toc-text"> docker tag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-save"><span class="toc-number">1.5.2.6.</span> <span class="toc-text"> docker save</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-load"><span class="toc-number">1.5.2.7.</span> <span class="toc-text"> docker load</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-export"><span class="toc-number">1.5.2.8.</span> <span class="toc-text"> docker export</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-import"><span class="toc-number">1.5.2.9.</span> <span class="toc-text"> docker import</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.3.</span> <span class="toc-text"> 容器命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-run"><span class="toc-number">1.5.3.1.</span> <span class="toc-text"> docker run</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exit"><span class="toc-number">1.5.3.2.</span> <span class="toc-text"> exit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-ps"><span class="toc-number">1.5.3.3.</span> <span class="toc-text"> docker ps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-rm"><span class="toc-number">1.5.3.4.</span> <span class="toc-text"> docker rm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-start"><span class="toc-number">1.5.3.5.</span> <span class="toc-text"> docker start</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.4.</span> <span class="toc-text"> 常用其他命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-log"><span class="toc-number">1.5.4.1.</span> <span class="toc-text"> docker log</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-top"><span class="toc-number">1.5.4.2.</span> <span class="toc-text"> docker top</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.5.5.</span> <span class="toc-text"> 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">1.6.</span> <span class="toc-text"> 可视化管理工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.7.</span> <span class="toc-text"> Docker 镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.7.1.</span> <span class="toc-text"> 镜像是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.7.2.</span> <span class="toc-text"> 镜像加载原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commit-%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.3.</span> <span class="toc-text"> Commit 镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.8.</span> <span class="toc-text"> 容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.8.1.</span> <span class="toc-text"> 什么是数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.8.2.</span> <span class="toc-text"> 使用数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98-mysql%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.8.3.</span> <span class="toc-text"> 实战: MySQL 同步数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">1.8.4.</span> <span class="toc-text"> 具名挂载和匿名挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E8%AF%86dockerfile"><span class="toc-number">1.8.5.</span> <span class="toc-text"> 初识 DockerFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">1.8.6.</span> <span class="toc-text"> 数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerfile"><span class="toc-number">1.9.</span> <span class="toc-text"> DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.9.1.</span> <span class="toc-text"> 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.2.</span> <span class="toc-text"> DockerFile 构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">1.9.3.</span> <span class="toc-text"> DockerFile 的指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E6%9B%B4%E5%8E%86%E5%8F%B2%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.9.4.</span> <span class="toc-text"> 变更历史查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cmd%E4%B8%8Eentrypoint"><span class="toc-number">1.9.5.</span> <span class="toc-text"> CMD 与 ENTRYPOINT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98-tomcat%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.6.</span> <span class="toc-text"> 实战: Tomcat 镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.9.7.</span> <span class="toc-text"> 发布自己的镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E6%B5%81%E7%A8%8B%E5%B0%8F%E7%BB%93"><span class="toc-number">1.10.</span> <span class="toc-text"> Docker 流程小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">1.11.</span> <span class="toc-text"> Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A4%E8%AF%86docker0"><span class="toc-number">1.11.1.</span> <span class="toc-text"> 认识 Docker0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E7%BD%91%E7%BB%9C%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90"><span class="toc-number">1.11.2.</span> <span class="toc-text"> Docker 网络原理浅析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Edocker%E7%9A%84ip%E5%88%92%E5%88%86"><span class="toc-number">1.11.2.1.</span> <span class="toc-text"> 关于 Docker 的 IP 划分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-%E5%AE%B9%E5%99%A8%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">1.11.2.2.</span> <span class="toc-text"> Docker 容器间通信</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-link"><span class="toc-number">1.11.3.</span> <span class="toc-text"> --Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E7%BD%91%E7%BB%9C%E6%8C%87%E4%BB%A4"><span class="toc-number">1.11.4.</span> <span class="toc-text"> Docker 网络指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">1.11.5.</span> <span class="toc-text"> 自定义网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.11.5.1.</span> <span class="toc-text"> Docker 的网络模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9Cnetwork-create"><span class="toc-number">1.11.5.2.</span> <span class="toc-text"> 创建自定义网络 (network create)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%81%94%E9%80%9Anetwork-connect"><span class="toc-number">1.11.6.</span> <span class="toc-text"> 网络联通 (network connect)</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="别人都叫我老范"
      data-src="/images/%E5%90%90%E8%88%8C.jpeg">
  <p class="name" itemprop="name">别人都叫我老范</p>
  <div class="description" itemprop="description"><div style='font-size: 0.8em;'> I.is (null); <br/>If (U.appear ()) <br/>I.turn (new World ('Fill With Love')) <br/>// 我的世界 <br/>// 直至遇见你 <br/>// 才熠熠生辉 </div> </div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">44</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">17</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">14</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL093bGNpdHkyMzMz" title="https:&#x2F;&#x2F;github.com&#x2F;Owlcity2333"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTI1MTg0NjMxMw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;251846313"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span>
      <span class="exturl item weixin" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTI1MTg0NjMxMw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;251846313"><i class="ic i-weixin"></i></span>
      <span class="exturl item email" data-url="bWFpbHRvOjc1OTU0NzkxNkBxcS5jb20=" title="mailto:759547916@qq.com"><i class="ic i-envelope"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>文章</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>

</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/qian-duan/angular/angular-ru-men/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/hou-duan/ci-cd/ci-cd-jenkins/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>随机文章</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/java/" title="分类于 java">java</a>
<i class="ic i-angle-right"></i>
<a href="/categories/java/basics/" title="分类于 基础">基础</a>
</div>

    <span><a href="/hou-duan/java/basics/java-ji-chu/" title="IO基础">IO基础</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/shu-ju-ku/shu-ju-ku-duo-biao-cha-xun/" title="数据库多表查询">数据库多表查询</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/qian-duan/js-h5/js-ji-chu/" title="JS总结">JS总结</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/qian-duan/js-h5/h5-xin-zeng/" title="H5新增内容总结">H5新增内容总结</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/hou-duan/java/java-de-nei-bu-lei/" title="java的内部类">java的内部类</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/hou-duan/ci-cd/maven/" title="Maven">Maven</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/hou-duan/bing-fa-fen-bu-shi/fen-bu-shi-shi-wu/" title="分布式事务">分布式事务</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/MQ/" title="分类于 MQ">MQ</a>
<i class="ic i-angle-right"></i>
<a href="/categories/MQ/%E5%88%86%E5%B8%83%E5%BC%8F/" title="分类于 分布式">分布式</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" title="分类于 微服务">微服务</a>
</div>

    <span><a href="/hou-duan/zhong-jian-jian/rocketmq-ru-men/" title="RocketMQ">RocketMQ</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/shu-ju-ku/shu-ju-ku-ji-chu/" title="数据库基础">数据库基础</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/CI-CD-K8s/" title="分类于 CI/CD - K8s">CI/CD - K8s</a>
</div>

    <span><a href="/hou-duan/ci-cd/k8s/" title="Kubernetes">Kubernetes</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>最新评论</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">别人都叫我老范 @ bit Blog</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">295k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">4:29</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: 'hou-duan/docker/docker-ru-men/',
    favicon: {
      show: "(^_^) 呦吼~",
      hide: "(´Д｀)哪去了?"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,fancybox: true,copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"superSample":2,"width":180,"height":360,"position":"right","hOffset":-20,"vOffset":-15},"log":false,"tagMode":false});</script></body>
</html>
